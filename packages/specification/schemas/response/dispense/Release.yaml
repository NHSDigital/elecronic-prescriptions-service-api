# https://github.com/OzzyCzech/mock-to-openapi

type: object
description: |
  The requested prescriptions,
  expressed as a FHIR bundle of 
  [prescription-order FHIR messages](https://simplifier.net/guide/NHSDigital-Medicines/Home/FHIRAssets/AllAssets/MessageDefinition-duplicate-2/prescription-order).
properties:
  resourceType:
    type: string
    default: Parameters
  id:
    type: string
    example: a5d77265-8ba5-4c74-b8ce-ea0dbaafbdb8
  parameter:
    type: array
    items:
      oneOf:
      - $ref: "#/components/schema/passedPrescriptions"
      - $ref: "#/components/schema/failedPrescriptions"

components:
  schema:
    passedPrescriptions:
      type: object
      properties:
        name:
          type: string
          default: passedPrescriptions
        resource:
          type: object
          properties:
            resourceType:
              type: string
              default: Bundle
            id:
              type: string
              example: 155e1102-9e71-4f19-9453-b905c0bbc494
            meta:
              type: object
              properties:
                lastUpdated:
                  type: string
                  format: date-time
                  example: "2023-03-13T14:00:00+00:00"
            identifier:
              type: object
              properties:
                system:
                  type: string
                  example: https://tools.ietf.org/html/rfc4122
                value:
                  type: string
                  example: 155e1102-9e71-4f19-9453-b905c0bbc494
            type:
              type: string
              default: searchset
            link:
              type: array
              items:
                type: object
                properties:
                  relation:
                    type: string
                    example: self
                  url:
                    type: string
                    example: https://sandbox.api.service.nhs.uk/electronic-prescriptions/Task/$release
            total:
              type: integer
              format: int32
              example: 1
            entry:
              type: array
              items:
                type: object
                properties:
                  fullUrl:
                    type: string
                    example: urn:uuid:0cb82cfa-76c8-4fb2-a08e-bf0e326e5487
                  search:
                    type: object
                    properties:
                      mode:
                        type: string
                        example: match
                  resource:
                    type: object
                    properties:
                      resourceType:
                        type: string
                        default: Bundle
                      id:
                        type: string
                        example: 0cb82cfa-76c8-4fb2-a08e-bf0e326e5487
                      timestamp:
                        type: string
                        format: date-time
                        example: "2023-03-13T13:47:00+00:00"
                      identifier:
                        type: object
                        properties:
                          system:
                            type: string
                            example: https://tools.ietf.org/html/rfc4122
                          value:
                            type: string
                            example: 46183abc-9fad-4673-85db-ce2cb6614732
                      type:
                        type: string
                        example: message
                      entry:
                        type: array
                        items:
                          oneOf:
                          - $ref: "../../components/MessageHeader/ReleaseResponseMessageHeader.yaml"
                          - $ref: "../../components/MedicationRequest/ReleaseResponseMedicationRequest.yaml"
                          - $ref: "../../components/Patient/Patient.yaml"
                          - $ref: "../../components/PractitionerRole/ReleaseResponsePractitionerRole.yaml"
                          - $ref: "../../components/Practitioner/ReleaseResponsePractitioner.yaml"
                          - $ref: "../../components/Organization/Organization.yaml"
                          - $ref: "../../components/Provenance/ReleaseResponseProvenance.yaml"
    failedPrescriptions:
      type: object
      properties:
        name:
          type: string
          enum: [failedPrescriptions]
        resource:
          type: object
          properties:
            resourceType:
              type: string
              enum: [Bundle]
            id:
              type: string
              example: 223cab8a-4173-4e86-9d0b-0afe7bd4965b
            meta:
              type: object
              properties:
                lastUpdated:
                  type: string
                  format: date-time
                  example: "2023-03-09T11:25:25+00:00"
            identifier:
              type: object
              properties:
                system:
                  type: string
                  example: https://tools.ietf.org/html/rfc4122
                value:
                  type: string
                  example: 9fa27fc5-052a-4abf-83ca-aee2742a870e
            type:
              type: string
              enum: [searchset]
            total:
              type: integer
              format: int32
              example: 1
            entry:
              type: array
              items:
                oneOf:
                  - type: object
                    properties:
                      resourceType:
                        type: string
                        enum: [OperationOutcome]
                      meta:
                        type: object
                        properties:
                          lastUpdated:
                            type: string
                            format: date-time
                            example: "2023-03-09T11:25:25+00:00"
                      extension:
                        type: array
                        items:
                          type: object
                          properties:
                            url:
                              type: string
                              example: https://fhir.nhs.uk/StructureDefinition/Extension-Spine-supportingInfo-prescription
                            valueReference:
                              type: object
                              properties:
                                identifier:
                                  type: object
                                  properties:
                                    system:
                                      type: string
                                      example: https://tools.ietf.org/html/rfc4122
                                    value:
                                      type: string
                                      example: 1012093c-788a-445a-a197-04c02fcaf829
                      issue:
                        type: array
                        items:
                          type: object
                          properties:
                            severity:
                              type: string
                              example: error
                            code:
                              type: string
                              example: invalid
                            details:
                              type: object
                              properties:
                                coding:
                                  type: array
                                  items:
                                    type: object
                                    properties:
                                      system:
                                        type: string
                                        example: https://fhir.nhs.uk/CodeSystem/Spine-ErrorOrWarningCode
                                      code:
                                        type: string
                                        example: INVALID_VALUE
                                      display:
                                        type: string
                                        example: Signature is invalid.
                            expression:
                              type: array
                              items:
                                type: string
                                example: Provenance.signature.data
