# https://github.com/OzzyCzech/mock-to-openapi

type: object
description: |
  The requested prescriptions,
  expressed as a FHIR bundle of 
  [prescription-order FHIR messages](https://simplifier.net/guide/NHSDigital-Medicines/Home/FHIRAssets/AllAssets/MessageDefinition-duplicate-2/prescription-order).
properties:
  resourceType:
    type: string
    enum: [Parameters]
  parameter:
    type: array
    items:
      oneOf:
      - $ref: "#/components/schema/passedPrescriptions"
      - $ref: "#/components/schema/failedPrescriptions"

components:
  schema:
    passedPrescriptions:
      type: object
      properties:
        name:
          type: string
          enum: [passedPrescriptions]
        resource:
          type: object
          properties:
            resourceType:
              type: string
              enum: [Bundle]
            id:
              type: string
              example: 155e1102-9e71-4f19-9453-b905c0bbc494
            meta:
              type: object
              properties:
                lastUpdated:
                  type: string
                  format: date-time
                  example: "2021-07-15T11:25:25+00:00"
            identifier:
              type: object
              properties:
                system:
                  type: string
                  example: https://tools.ietf.org/html/rfc4122
                value:
                  type: string
                  example: 53aa80e7-7ccb-485e-b544-214bba1334a9
            type:
              type: string
              enum: [searchset]
            total:
              type: integer
              format: int32
              example: 1
            entry:
              type: array
              items:
                # messageBundle?
                type: object
                properties:
                  resource:
                    type: object
                    properties:
                      resourceType:
                        type: string
                        example: Bundle
                      id:
                        type: string
                        example: 67ca2830-4934-41ad-95d0-f31d9f8b61fb
                      meta:
                        type: object
                        properties:
                          lastUpdated:
                            type: string
                            format: date-time
                            example: "2021-07-15T11:24:43+00:00"
                      identifier:
                        type: object
                        properties:
                          system:
                            type: string
                            example: https://tools.ietf.org/html/rfc4122
                          value:
                            type: string
                            example: ed4a6ba4-ef83-47d4-aa48-6c7fb437905e
                      type:
                        type: string
                        enum: [message]
                      entry:
                        type: array
                        items:
                          oneOf:
                          - $ref: "#/components/schema/MessageHeader"
                  fullUrl:
                    type: string
                    example: urn:uuid:67ca2830-4934-41ad-95d0-f31d9f8b61fb

    failedPrescriptions:
      type: object
      properties:
        name:
          type: string
          enum: [failedPrescriptions]
        resource:
          type: object
          properties:
            resourceType:
              type: string
              enum: [Bundle]
            id:
              type: string
              example: 223cab8a-4173-4e86-9d0b-0afe7bd4965b
            meta:
              type: object
              properties:
                lastUpdated:
                  type: string
                  format: date-time
                  example: "2023-03-09T11:25:25+00:00"
            identifier:
              type: object
              properties:
                system:
                  type: string
                  example: https://tools.ietf.org/html/rfc4122
                value:
                  type: string
                  example: 9fa27fc5-052a-4abf-83ca-aee2742a870e
            type:
              type: string
              enum: [searchset]
            total:
              type: integer
              format: int32
              example: 1
            entry:
              type: array
              items:
                oneOf:
                  - type: object
                    properties:
                      resourceType:
                        type: string
                        enum: [OperationOutcome]
                      meta:
                        type: object
                        properties:
                          lastUpdated:
                            type: string
                            format: date-time
                            example: "2023-03-09T11:25:25+00:00"
                      extension:
                        type: array
                        items:
                          type: object
                          properties:
                            url:
                              type: string
                              example: https://fhir.nhs.uk/StructureDefinition/Extension-Spine-supportingInfo-prescription
                            valueReference:
                              type: object
                              properties:
                                identifier:
                                  type: object
                                  properties:
                                    system:
                                      type: string
                                      example: https://tools.ietf.org/html/rfc4122
                                    value:
                                      type: string
                                      example: 1012093c-788a-445a-a197-04c02fcaf829
                      issue:
                        type: array
                        items:
                          type: object
                          properties:
                            severity:
                              type: string
                              example: error
                            code:
                              type: string
                              example: invalid
                            details:
                              type: object
                              properties:
                                coding:
                                  type: array
                                  items:
                                    type: object
                                    properties:
                                      system:
                                        type: string
                                        example: https://fhir.nhs.uk/CodeSystem/Spine-ErrorOrWarningCode
                                      code:
                                        type: string
                                        example: INVALID_VALUE
                                      display:
                                        type: string
                                        example: Signature is invalid.
                            expression:
                              type: array
                              items:
                                type: string
                                example: Provenance.signature.data
                  # messageBundle?
                  - type: object
                    properties:
                      resource:
                        type: object
                        properties:
                          resourceType:
                            type: string
                            example: Bundle
                          id:
                            type: string
                            example: 67ca2830-4934-41ad-95d0-f31d9f8b61fb
                          meta:
                            type: object
                            properties:
                              lastUpdated:
                                type: string
                                format: date-time
                                example: "2021-07-15T11:24:43+00:00"
                          identifier:
                            type: object
                            properties:
                              system:
                                type: string
                                example: https://tools.ietf.org/html/rfc4122
                              value:
                                type: string
                                example: ed4a6ba4-ef83-47d4-aa48-6c7fb437905e
                          type:
                            type: string
                            enum: [message]
                          entry:
                            type: array
                            items:
                              oneOf:
                              - $ref: "#/components/schema/MessageHeader"
                      fullUrl:
                        type: string
                        example: urn:uuid:67ca2830-4934-41ad-95d0-f31d9f8b61fb
