type: object
required:
  - resourceType
  - identifier
  - status
  - intent
  - category
  - medicationCodeableConcept
  - subject
  - authoredOn
  - requester
  - groupIdentifier
  - courseOfTherapyType
  - dosageInstruction
  - dispenseRequest
  - substitution
description: An entity representing the line items on a prescription in the context of a dispense notification.
properties:
  resourceType:
    type: string
    description: FHIR resource type
    enum: [MedicationRequest]
  id:
    type: string
    example: f6741534-773e-4e26-9eec-c868f61898b3
  extension:
    type: array
    description: A FHIR extension array.
    items:
      oneOf:
      - $ref: ../_extensions/ControlledDrug.yaml
      - $ref: ../_extensions/DMResponsiblePractitioner.yaml
      - $ref: ../_extensions/DispensingInformation.yaml
      - $ref: ../_extensions/MedicationRepeatInformation.yaml
      - $ref: ../_extensions/NHSBSAPrescriptionType.yaml
      - $ref: ../_extensions/PrescriptionEndorsement.yaml
  identifier:
    type: array
    description: The unique identifier of the line item that is being dispensed.
    items:
      type: object
      properties:
        system:
          type: string
          description: Codesystem URL for the line item ID.
          enum: [https://fhir.nhs.uk/Id/prescription-order-item-number]
        value:
          type: string
          description: The unique ID for a given line item.
          example: dd11b07e-e137-488e-bc28-ab50384208b5
  status:
    type: string
    description: The status of a MedicationRequest object. 
    enum: [active, cancelled, completed]
  intent:
    type: string
    description: The intent of a MedicationRequest object. 
    enum: [order, original-order, instance-order]
  category:
    type: array
    description: |
      Identifies the context in which a prescription is created.
      For example, a prescription created within primary care will be categorised as "community."
      Similarly, a prescription created within secondary care will be categorised as "inpatient" or "outpatient."
    items:
      type: object
      properties:
        coding:
          type: array
          items:
            type: object
            properties:
              system:
                type: string
                description: Codesystem URL for the prescription category.
                enum: [http://terminology.hl7.org/CodeSystem/medicationrequest-category]
              code:
                type: string
                description: Code for the prescription category.
                enum: [inpatient, outpatient, community, discharge]
              display:
                type: string
                description: Display value for the prescription category.
                enum: [Inpatient, Outpatient, Community, Discharge]
  medicationCodeableConcept:
    type: object
    description: The original drug prescribed to the patient, expressed as a VMP or AMP concept.
    properties:
      coding:
        type: array
        items:
          type: object
          properties:
            system:
              type: string
              description: SNOMED codesystem URL
              enum: [http://snomed.info/sct]
            code:
              type: string
              description: SNOMED code for the medication, as defined in the DM+D
              example: "39732311000001104"
            display:
              type: string
              description: a human readable name for the medication.
              example: Diazepam 2mg tablets
  subject:
    type: object
    description: |
      Reference object to identify the patient a prescription is for. 
      A Patient resource within the Bundle must be referenced.
    properties:
      identifier:
        type: object
        properties:
          system:
            type: string
            enum: [https://fhir.nhs.uk/Id/nhs-number]
          value:
            type: string
            example: "9449304130"
      display:
        type: string
        example: Ms Marisa Stacey Twitchett
  authoredOn:
    type: string
    description: The time at which the prescription was authored and signed.
    format: date-time
    example: "2021-05-07T14:47:29+00:00"
  requester:
    type: object
    description: Reference object to identify the author of a prescription. 
    properties:
      identifier:
        type: object
        properties:
          system:
            type: string
            enum: [https://fhir.nhs.uk/Id/sds-role-profile-id]
          value:
            type: string
            example: "200102238987"
  groupIdentifier:
    type: object
    required: [value]
    description: An object containing the short-form and long-form Prescription IDs of the prescription that is being dispensed.
    properties:
      system:
        type: string
        description: Codesystem URL for the short-form Prescription ID.
        enum: [https://fhir.nhs.uk/Id/prescription-order-number]
      value:
        type: string
        description: The short-form Prescription ID.
        example: 04F4C2-A99968-7F717P
      extension:
        type: array
        description: A FHIR extension array containing the long-form Prescription ID.
        items:
          $ref: ../_extensions/DMPrescriptionId.yaml
  courseOfTherapyType:
    type: object
    description: Denotes whether a prescription is an acute, a repeat, or an eRD.
    properties:
      coding:
        type: array
        items:
          type: object
          properties:
            system:
              type: string
              description: Codesystem URL for the prescription treatment type.
              enum: [http://terminology.hl7.org/CodeSystem/medicationrequest-course-of-therapy]
            code:
              type: string
              description: |
                code identifying the prescription treatment type.
                * acute: acute prescriptions
                * continuous: repeat prescriptions
                * continuous-repeat-dispensing: eRD prescriptions
              enum: [acute, continuous, continuous-repeat-dispensing]
            display:
              type: string
              description: Display value for the prescription treatment type.
              enum: [Short course (acute) therapy, Continuous long term therapy, Continuous long term (repeat dispensing)]
  dosageInstruction:
    type: array
    description: |
      The dosage instructions for a prescription. 
      These must be expressed as both structured dose and text.
    items:
      type: object
      properties:
        text:
          type: string
          description: The dosage instructions expressed as text.
          example: 4 times a day - Oral
        timing:
          type: object
          description: A structured expression of dose frequency.
          properties:
            repeat:
              type: object
              description: The frequency and period over which the medication should be consumed.
              properties:
                frequency:
                  type: integer
                  description: |
                    The frequency at which the medication should be consumed within a given period.
                    E.g. "4" for 4 times over a given period. 
                  format: int32
                  example: 4
                period:
                  type: integer
                  description: |
                      The period over which the frequency applies.
                      e.g. "1" for 1 day.
                  format: int32
                  example: 1
                periodUnit:
                  type: string
                  description: The fundamental unit of the period, defined in UCUM.
                  example: d
        route:
          type: object
          description: A structured expression of how the medication should be consumed.
          properties:
            coding:
              type: array
              items:
                type: object
                properties:
                  system:
                    type: string
                    description: SNOMED codesystem URL.
                    enum: [http://snomed.info/sct]
                  code:
                    type: integer
                    description: Valid SNOMED code identifying how the medication should be consumed.
                    example: "26643006"
                  display:
                    type: string
                    example: Oral
  dispenseRequest:
    type: object
    description: |
      A FHIR object containing information relevant to how the prescription should be dispensed. 
      These values should be consistent across all MedicationRequests in a Bundle.
    required: [quantity]
    properties:
      extension:
        type: array
        description: A FHIR extension array.
        items:
          $ref: ../_extensions/DMPerformerSiteType.yaml
      numberOfRepeatsAllowed:
        type: integer
        description: |
          For eRD and repeat prescriptions only.
          The number of repeats a line item is issued for, in addition to the existing issue. E.g. if a prescription is valid for 6 issues in total, the value entered must be 5. 
          For repeat prescriptions, this value must always default to 0.
      validityPeriod:
        type: object
        description: The start and end dates of a prescription.
        properties:
          start:
            type: string
            description: Start date of an issue; sometimes same as prescription's start date.
            format: date
            example: "2022-10-21"
          end:
            type: string
            description: |
              End date of an issue; capped at 12 months and cannot exceed the prescription's end date.
              Overall validity of the drug.
            format: date
            example: "2022-10-21"
      expectedSupplyDuration:
        type: object
        description: |
          For eRD prescriptions only. 
          Duration of each issue in days; defaults to 28.
        properties:
          value:
            type: integer
            description: The number of days each issue in an eRD prescription is valid for.
            format: int32
            default: 28
          unit:
            type: string
            description: The UCUM unit of measure display for days.
            default: day
          system:
            type: string
            description: Codesystem URL for UCUM.
            enum: [http://unitsofmeasure.org]
          code:
            type: string
            description: The UCUM unit of measure code for days.
            example: d
      performer:
        type: object
        description: |
          For nominated prescriptions only, including one-off nominations.
          The ODS code of the nominated pharmacy that a prescription is going to.
        properties:
          identifier:
            type: object
            properties:
              system:
                type: string
                description: Codesystem URL for ODS codes.
                enum: [https://fhir.nhs.uk/Id/ods-organization-code]
              value:
                type: string
                description: ODS code for the nominated dispenser.
                example: VNE51
      quantity:
        type: object
        description: The quantity of the drug prescribed to the patient.
        properties:
          value:
            type: integer
            description: The numeric value of the quantity being prescribed.
            format: int32
            example: 20
          unit:
            type: string
            description: The units in which the quantity is prescribed, defined using DM+D units of measure.
            example: tablet
          system:
            type: string
            description: SNOMED codesystem URL.
            enum: [http://snomed.info/sct]
          code:
            type: integer
            description: The DM+D code associated with a given unit of measure.
            example: 428673006
  substitution:
    type: object
    description: This is a boolean value that should always default to false because EPS does not support substitutions.
    properties:
      allowedBoolean:
        type: boolean
        enum: [false]
  note:
    type: array
    description: Specific additional instructions for a prescription line item, e.g. a change in dosage.
    items:
      type: object
      properties: 
        text:
          type: string
          description: Specific additional instructions for a prescription line item.
          example: Dosage has been decreased on advice from the hospital.
