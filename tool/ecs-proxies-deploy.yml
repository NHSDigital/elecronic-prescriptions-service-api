docker_service_cpu: 512
docker_service_memory: 1024
docker_service_health_check_grace_period_seconds: 180
docker_service:
    -   name: eps-api-tool
        port: 9000
        expose: true
        environment:
            -   name: FLASK_RUN_PORT
                value: "9000"
            -   name: LOG_LEVEL
                value: "{{ 'debug' if APIGEE_ENVIRONMENT == 'internal-dev' else 'info' }}"
            -   name: ENVIRONMENT
                value: "{{ APIGEE_ENVIRONMENT }}"
            -   name: PUBLIC_APIGEE_URL
                value: "https://{{ APIGEE_HOSTNAME }}"
            -   name: BASE_PATH
                value: "{{ SERVICE_BASE_PATH }}"
            -   name: REDIS_URL
                value: "redis://localhost:6379"
            -   name: HAPI_URL
                value: "http://localhost:9001"
        secrets:
            -   name: APIGEE_DOMAIN_NAME
                valueFrom: '/{{ account }}/platform-common/egress/hosts/apigee-{{ APIGEE_ENVIRONMENT }}'
            -   name: DEMO_APP_CLIENT_ID
                valueFrom: "/{{ account }}/api-deployment/eps-api-tool/{{ APIGEE_ENVIRONMENT }}/test-client/client-id"
            -   name: DEMO_APP_KEY_ID
                valueFrom: "/{{ account }}/api-deployment/eps-api-tool/{{ APIGEE_ENVIRONMENT }}/test-client/local-jwt-key-id"
            -   name: RSS_JWT_ISSUER
                valueFrom: "/{{ account }}/api-deployment/eps-api-tool/{{ APIGEE_ENVIRONMENT }}/test-client/rss-jwt-issuer"
            -   name: RSS_JWT_KID
                valueFrom: "/{{ account }}/api-deployment/eps-api-tool/{{ APIGEE_ENVIRONMENT }}/test-client/rss-jwt-key-id"
            -   name: APP_SIGNING_SUBJECT
                valueFrom: "/{{ account }}/api-deployment/eps-api-tool/{{ APIGEE_ENVIRONMENT }}/test-client/rss-jwt-subject"
            -   name: RSS_JWT_PRIVATE_KEY
                valueFrom: "arn:aws:secretsmanager:eu-west-2:{{ PTL_ACCOUNT_ID }}:secret:{{ account }}/eps-api-tool/{{ APIGEE_ENVIRONMENT }}/test-client/rss-jwt-private-key"
            -   name: DEMO_APP_PRIVATE_KEY
                valueFrom: "arn:aws:secretsmanager:eu-west-2:{{ PTL_ACCOUNT_ID }}:secret:{{ account }}/eps-api-tool/{{ APIGEE_ENVIRONMENT }}/test-client/local-jwt-private-key"
            -   name: DEMO_APP_CLIENT_KEY
                valueFrom: "arn:aws:secretsmanager:eu-west-2:{{ PTL_ACCOUNT_ID }}:secret:{{ account }}/eps-api-tool/{{ APIGEE_ENVIRONMENT }}/test-client/client-key"
            -   name: SESSION_TOKEN_ENCRYPTION_KEY
                valueFrom: "arn:aws:secretsmanager:eu-west-2:{{ PTL_ACCOUNT_ID }}:secret:{{ account }}/eps-api-tool/{{ APIGEE_ENVIRONMENT }}/test-client/session-token-encryption-key"
        health_check:
            matcher: "200"
            path: "/_healthcheck"
    -   name: eps-api-tool-hapi
        port: 9001
        expose: false
        environment:
            -   name: COMMIT_ID
                value: "{{ SOURCE_COMMIT_ID }}"
            -   name: REDIS_URL
                value: "localhost"
            -   name: REDIS_PORT
                value: "6379"
        secrets:
            -   name: APIGEE_DOMAIN_NAME
                valueFrom: '/{{ account }}/platform-common/egress/hosts/apigee-{{ APIGEE_ENVIRONMENT }}'
            -   name: SESSION_TOKEN_ENCRYPTION_KEY
                valueFrom: "arn:aws:secretsmanager:eu-west-2:{{ PTL_ACCOUNT_ID }}:secret:{{ account }}/eps-api-tool/{{ APIGEE_ENVIRONMENT }}/test-client/session-token-encryption-key"
        health_check:
            matcher: "200"
            path: "/_healthcheck"
    -   name: eps-api-tool-store
        port: 6379
        expose: false
        health_check:
            matcher: "200"
            path: "/_healthcheck"
