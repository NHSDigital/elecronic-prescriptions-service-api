# This is an OpenAPI Specification (https://swagger.io/specification/)
# for the Electronic Prescription Service (EPS) API
# owned by NHS Digital (https://digital.nhs.uk/)

openapi: 3.0.0
x-nhs-api-spec-guid: 5ead5713-9d2b-46eb-8626-def5fd2a2350
info:
  title: Electronic Prescription Service (FHIR) API
  version: "{VERSION}"
  contact:
    name: Electronic Prescription Service FHIR API Support
    url: "https://digital.nhs.uk/developer/help-and-support"
    email: "api.management@nhs.net"
  description: |
    ## Overview
    <style>.codeinline.example {word-wrap: anywhere;}</style>
    Use this API to access the [Electronic Prescription Service (EPS)](https://digital.nhs.uk/services/electronic-prescription-service). EPS is the national service used to send electronic prescription messages between prescribers and community dispensers.

    ### Prescribers in primary and secondary care can:
    * create a prescription
    * encode data so the prescription is ready to sign
    * cancel a prescription
    
    Prescribers create and cancel a prescription but the prescribing system encodes data so the prescription is ready to sign.
  
    ### Dispensers can:
    * download an individual prescription from EPS
    * download a batch of prescriptions from EPS
    * verify a prescription's signature
    * return a prescription to EPS
    * submit a dispense notification to EPS
    * withdraw a dispense notification from EPS
    * submit a dispense claim
    
    You cannot currently use this API to:
    * view a prescription's detailed dispense history

    ## Who can use this API
    This API can only be used where there is a legal basis to do so. Make sure you have a [valid use case](https://digital.nhs.uk/services/electronic-prescription-service/enabling-eps-for-your-service) before you go too far with your development. 
    
    You must get approval before you can go live. For more information, see the 'Onboarding' section.

    ## Related APIs, services and documentation
       
    ### Services
    These services must be used to create a functioning system using EPS that meets assurance standards. 
    * [Care Identity Service 2 (CIS2)](https://digital.nhs.uk/services/identity-and-access-management/national-care-identity-service) - use this to authenticate prescribers with their smartcard.
    * [Directory of Services (DOS)](https://digital.nhs.uk/developer/api-catalogue/electronic-prescription-service-directory-of-services) - prescribers must use the DOS to find dispensing sites for patients.
    * [Organisation Data Service (ODS)](https://digital.nhs.uk/services/organisation-data-service) - use this to access ODS codes for prescribing organisations.
    * [Personal Demographics Service (PDS)](https://digital.nhs.uk/developer/api-catalogue/personal-demographics-service-fhir) - use PDS to synchronise a patient's demographic details including their name, date of birth and address.
    * [Signing Service](https://digital.nhs.uk/developer/api-catalogue/signing-service) - use the signing service API to create signatures for prescriptions. The signing service is only used for EPS.
    * [Role-Based Access Controls (RBAC)](https://digital.nhs.uk/developer/guides-and-documentation/security-and-authorisation/national-rbac-for-developers) - RBAC rules are stored in the National RBAC Database (NRD) and are used to limit what prescribers can and cannot do.
    * [GP2GP](https://digital.nhs.uk/services/gp2gp) - use the GP2GP service to transfer patient details, including nominated dispensers, between GPs.
    * [Message Exchange for Social Care and Health (MESH)](https://digital.nhs.uk/developer/api-catalogue/message-exchange-for-social-care-and-health-api) - Use MESH to deliver and receive cancel responses.
    * [Prescription Tracker](https://developer.nhs.uk/apis/eps-tracker) - use this if you want a read-only interface to get information about a patient's prescriptions.
    
    [EPS HL7 V3](https://digital.nhs.uk/developer/api-catalogue/electronic-prescription-service-hl7-v3) is also available if you want to use functions that are not yet available on the FHIR API.

    ### Documentation
    This documentation must be used in the API to meet assurance requirements when integrating with EPS.
    * [Dictionary of Medicines and Devices (DM+D)](https://www.nhsbsa.nhs.uk/pharmacies-gp-practices-and-appliance-contractors/dictionary-medicines-and-devices-dmd) - the DM+D has the names, descriptions and unique identifiers for medicines and devices that can be prescribed.
    * [Business Services Authority (BSA)](https://www.nhsbsa.nhs.uk/) - the BSA website has guidance and codes for endorsements and prescription types for reimbursement.
    
    ### Guidance for developers and product owners
    Documentation and guidance about EPS for technical and non-technical audiences
    * [Simplifier implementation guide for digital medicines](https://simplifier.net/guide/ukcoreimplementationguideformedicines?version=current) - the implementation guide contains detailed information and example messages, error codes and processes. This is for technical audiences like developers.
    * [Building healthcare software - prescriptions](https://digital.nhs.uk/developer/guides-and-documentation/building-healthcare-software/prescriptions) - this explains how to build software that deals with prescriptions. This is for non-technical audiences like product owners.

    ## API status and roadmap
    The immediate priority of EPS development is to support the rollout of the next-gen FHIR APIs for primary care and secondary care prescribing and dispensing.
    
    ### Prescribing
    The API supports prescribers in primary and secondary care settings. This means prescriptions are sent from a GP or NHS hospital to a pharmacy. For these workflows, the API is in [beta](https://digital.nhs.uk/developer/guides-and-documentation/reference-guide#api-status), meaning:
    * it is available in integration and production
    * we might make breaking changes, but only if we cannot avoid it, and we will give advance notice
    
    ### Dispensing
    This API supports a community pharmacy dispensing workflow.

    In a community pharmacy workflow, prescriptions can be released (downloaded) from EPS, updated, dispensed, and then claimed by the pharmacy. For this workflow, the API is in [alpha](https://digital.nhs.uk/developer/guides-and-documentation/reference-guide#api-status), meaning:
    - it is available for testing in the integration environment, but not for production use
    - we might make breaking changes, but only if we cannot avoid it, and we will give advance notice

    ### Roadmap
    To see our roadmap, or to suggest, comment or vote on features for this API, see our [interactive product backlog](https://nhs-digital-api-management.featureupvote.com/?tag=eps-fhir-api).
    
    If you have any other queries, please [contact us](https://digital.nhs.uk/developer/help-and-support).

    ## Service level
    This API is a bronze service, meaning it is operational and supported only during business hours (8am to 6pm), Monday to Friday excluding bank holidays.

    For more details, see [service levels](https://digital.nhs.uk/developer/guides-and-documentation/reference-guide#service-levels).

    ## Technology
    This API is [RESTful](https://digital.nhs.uk/developer/guides-and-documentation/our-api-technologies#basic-rest).
 
    It conforms to the [FHIR](https://digital.nhs.uk/developer/guides-and-documentation/our-api-technologies#fhir) global standard for health care data exchange, specifically to [FHIR R4 (v4.0.1)](https://hl7.org/fhir/r4/), except that it does not support the [capabilities](http://hl7.org/fhir/R4/http.html#capabilities) interaction.
    
    It includes some country-specific FHIR extensions, which are built against [FHIR UK Core, specifically [UKcore.stu1 0.5.1](https://simplifier.net/packages/fhir.r4.ukcore.stu1/0.5.1).
    
    You do not need to know much about FHIR to use this API - FHIR APIs are just RESTful APIs that follow specific rules. In particular:
    * resource names are capitalised and singular, for example `/Patient` not `/patients`
    * array names are singular, for example `line` not `lines` for address lines
    * data items that are country-specific and thus not included in the FHIR global base resources are usually wrapped in an `extension` object
    
    There are [libraries and software development kits available](https://digital.nhs.uk/developer/guides-and-documentation/api-technologies-at-nhs-digital#fhir-libraries-and-sdks) to help with FHIR API integration.


    ## Network access
    This API is available on the internet and, indirectly, on the [Health and Social Care Network (HSCN)](https://digital.nhs.uk/services/health-and-social-care-network).
    To use this API with [NHS smartcards](https://digital.nhs.uk/developer/guides-and-documentation/security-and-authorisation/nhs-smartcards-for-developers) you do need an HSCN connection, although internet-facing alternatives are available.

    For more details see [Network access for APIs](https://digital.nhs.uk/developer/guides-and-documentation/network-access-for-apis).

    ## Security and authorisation
    This API has 2 access modes:
    * user-restricted access
    * application-restricted access
    
    ### User-restricted access
    The EPS APIs are mostly [user-restricted](https://digital.nhs.uk/developer/guides-and-documentation/security-and-authorisation#user-restricted-apis),
    meaning we authenticate the end user.
  
    EPS only supports [CIS2 separate authentication and authorisation](https://digital.nhs.uk/developer/guides-and-documentation/security-and-authorisation/user-restricted-restful-apis-nhs-cis2-separate-authentication-and-authorisation).
    Do not use combined authentication and authorisation.
 
    The only interaction that is not user-restricted is releasing nominated prescriptions.
  
    ### Application-restricted access
    Use this access mode to release nominated prescriptions while dispensing. 
    
    To use this access mode, use the following security pattern:
    * [Application-restricted RESTful API - signed JWT authentication](https://digital.nhs.uk/developer/guides-and-documentation/security-and-authorisation/application-restricted-restful-apis-signed-jwt-authentication)

    ## Environment and testing
    | Environment       | Base URL                                                            |
    | -------------     | --------------------------------------------------------------------|
    | Sandbox           | `https://sandbox.api.service.nhs.uk/electronic-prescriptions`       |
    | Integration test  | `https://int.api.service.nhs.uk/electronic-prescriptions`           |
    | Production        |  `https://api.service.nhs.uk/electronic-prescriptions`                                                 |

    ### Sandbox testing
    Our [sandbox environment](https://digital.nhs.uk/developer/guides-and-documentation/testing#sandbox-testing):

    * is for early developer testing
    * only covers a limited set of scenarios
    * is stateless, so it does not actually persist any updates
    * is open access, so does not allow you to test authorisation

    For details of sandbox testing, or to try out the sandbox using our "Try this API" feature, see the documentation for each endpoint.

    ### Integration testing
    Our [integration test environment](https://digital.nhs.uk/developer/guides-and-documentation/testing#integration-testing):

    * is for formal integration testing
    * is stateful, so persists updates
    * includes authorisation, with [smartcard](https://digital.nhs.uk/developer/guides-and-documentation/security-and-authorisation/nhs-smartcards-for-developers) and non-smartcard options

    For more details see [integration testing with our RESTful APIs](https://digital.nhs.uk/developer/guides-and-documentation/testing#integration-testing-with-our-restful-apis).

    ## Onboarding
    You need to get your software approved by us before it can go live with this API. We call this onboarding.
    The onboarding process can sometimes be quite long, so it’s worth planning well ahead.

    To begin the onboarding process please download and complete the [EPS use case form](https://nhs-prod.global.ssl.fastly.net/binaries/content/assets/website-assets/developer/electronic-prescription-service-fhir-api/eps-access-form-v1.0-org-short-name-yyyymmdd-1.docx) and email it to us at [epsonboarding@nhs.net](mailto:epsonboarding@nhs.net).

    ## Resources
    Use the [Digital Medicines Implementation Guide](https://simplifier.net/guide/NHSDigital-Medicines) to assist with your integration.
    This is the FHIR specification for Digital Medicines starting with the assets required for an electronic prescription sent to the EPS.
    
    For further guidance on prescribing, see [EPS prescribing developer guide](https://digital.nhs.uk/developer/guides-and-documentation/building-healthcare-software/prescriptions/eps-prescriber-developer-guide).


x-spec-publication:
  operation-order:
  - operations:
    - method: POST
      path: /FHIR/R4/$prepare
    - method: POST
      path: /FHIR/R4/$process-message#prescription-order
    - method: POST
      path: /FHIR/R4/$process-message#prescription-order-update
    - method: POST
      path: /FHIR/R4/Task/$release
    - method: POST
      path: /FHIR/R4/$verify-signature
    - method: POST
      path: /FHIR/R4/$process-message#dispense-notification
    - method: POST
      path: /FHIR/R4/Claim
    - method: POST
      path: /FHIR/R4/Task#return
    - method: POST
      path: /FHIR/R4/Task#withdraw
    - method: GET
      path: /FHIR/R4/Task

servers:
  - url: 'https://sandbox.api.service.nhs.uk/electronic-prescriptions'
    description: 'Sandbox'
  - url: 'https://int.api.service.nhs.uk/electronic-prescriptions'
    description: 'Integration test'
tags:
  - name: prescribing
  - name: dispensing
  - name: tracker
paths:
  /FHIR/R4/$prepare:
    post:
      operationId: prepare-prescription
      summary: Encode prescription data so it's ready to sign - Prescribing
      description: |
        ## Overview
        Use this endpoint to convert an unsigned FHIR prescription into the piece of data that needs to be digitally signed.
        
        This action is done by the prescribing system and API, not the prescriber.
        
      tags:
        - prescribing
      parameters:
        - $ref: '#/components/parameters/BearerAuthorization'
        - $ref: '#/components/parameters/RoleId'
        - $ref: '#/components/parameters/RequestID'
        - $ref: '#/components/parameters/CorrelationID'
      requestBody:
        required: true
        content:
          application/fhir+json:
            schema:
              $ref: '#/components/schemas/Encode-Request-Bundle'
            examples:
              example:
                description: |
                  A valid secondary care prepare request. More examples of this message can be found [here](https://simplifier.net/guide/NHSDigital-Medicines/Home/Examples/AllExamples?version=current#Home/Examples/AllExamples/Messageprescription-order).
                value:
                  $ref: components/examples/secondary-care/community/acute/nominated-pharmacy/nurse/prescribing-and-professional-codes/1-Prepare-Request-200_OK.json
      responses:
        '200':
          description: Successful conversion.
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/schemas/parameters-response'
              examples:
                example:
                  description: |
                    A successful response to a prepare request.
                  value:
                    $ref: components/examples/secondary-care/community/acute/nominated-pharmacy/nurse/prescribing-and-professional-codes/1-Prepare-Response-200_OK.json
        '4XX':
          description: Invalid request.
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/schemas/operation-outcome'
              examples:
                example:
                  description: |
                    An error response to a prepare request.
                  value:
                    $ref: components/examples/example-a-validation-error-missing-field/Response-FhirError.json
  /FHIR/R4/$process-message#prescription-order:
    post:
      operationId: send-prescription-order-message
      summary: Create a new prescription - Prescribing
      description: |
        ## Overview
        Use this endpoint to create a new prescription in EPS.
        
        The prescription must include a digital signature, which can be generated using the [Signing Service](https://digital.nhs.uk/developer/api-catalogue/signing-service).

        The `#prescription-order` in the URL has been added to distinguish this from the other operations which
        can be performed using the [`$process-message` endpoint](https://simplifier.net/guide/NHSDigital/Home/FHIRAssets/AllAssets/OperationDefinition/process-message). It is not required in requests to the API.
      tags:
        - prescribing
      parameters:
        - $ref: '#/components/parameters/BearerAuthorization'
        - $ref: '#/components/parameters/RoleId'
        - $ref: '#/components/parameters/RequestID'
        - $ref: '#/components/parameters/CorrelationID'
      requestBody:
        required: true
        content:
          application/fhir+json:
            schema:
              $ref: '#/components/schemas/Create-Request-Bundle'
            examples:
              prescription-order-success:
                description: |
                  A valid secondary care prescription-order message.
                value:
                  $ref: components/examples/secondary-care/community/acute/nominated-pharmacy/nurse/prescribing-and-professional-codes/1-Process-Request-Send-200_OK.json
        description: ''
      responses:
        '200':
          description: Successfully submitted.
          content:
            application/fhir+json:
              schema:
                type: object
                description: Confirmation that the prescription has been created, expressed as a [FHIR OperationOutcome resource](https://www.hl7.org/fhir/operationoutcome.html).
              examples:
                operation-outcome-success:
                  description: |
                    A successful response to a prescription-order, dispense-notification or dispense-claim request.
                  value:
                    $ref: components/examples/operation-outcome-success.json
        '4XX':
          description: |
            An error occurred as follows:

            | HTTP status | Error code                 | Description                                                                                                                           |
            | ----------- | ---------------------------| ------------------------------------------------------------------------------------------------------------------------------------- |
            | 400         | MISSING_DIGITAL_SIGNATURE  | Digital signature not found.                                                                                                          |
            | 400         | DUPLICATE_PRESCRIPTION_ID  | Duplicate prescription ID exists.                                                                                                     |
            | 400         | FAILURE_TO_PROCESS_MESSAGE | Unable to process message for example where the prescription ID has an invalid checksum or an invalid NHS number is passed.           |
            | 400         | BAD_REQUEST                | Invalid request.                                                                                                                      |
            | 400         | MISSING_FIELD              | A required field is missing within the request, see `display` field in response.                                                      |
            | 400         | INVALID_VALUE              | Invalid value in message.                                                                                                             |
            | 400         | INCORRECT_RESOURCETYPE     | FHIR resource has an incorrect resourceType.                                                                                          |
            | 401         | ACCESS_DENIED              | User does not have permission for a particular request.                                                                               |
            | 403         | FORBIDDEN                  | Insufficient authorization.                                                                                                           |
            | 404         | NOT_FOUND                  | Route not found.                                                                                                                      |
            | 500         | INTERNAL SERVER ERROR      | The server has encountered a situation it does not know how to handle.                                                                |
            | 504         | GATEWAY_TIMEOUT            | If your request has not been fully processed within 59 seconds, you will get this response. Retry the request with identical payload. |
            
            
            
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/schemas/operation-outcome'
              examples:
                OperationOutcome:
                  description: |
                    An error response.
                  value:
                    $ref: components/examples/example-a-validation-error-missing-field/Response-FhirError.json
  /FHIR/R4/$process-message#prescription-order-update:
    post:
      operationId: send-prescription-order-update-message
      summary: Cancel a prescription - Prescribing
      description: |
        ## Overview
        Use this endpoint to cancel a prescription.

        The effect of calling this endpoint depends on the type of the message, which is determined by the `MessageHeader` resource.
        To cancel a prescription, send a [prescription-order-update message](https://simplifier.net/guide/NHSDigital-Medicines/Home/FHIRAssets/AllAssets/MessageDefinition-duplicate-2/prescription-order-update).

        The `#prescription-order-update` in the URL has been added to distinguish this from the other operations which
        can be performed using the [`$process-message` endpoint](https://simplifier.net/guide/NHSDigital/Home/FHIRAssets/AllAssets/OperationDefinition/process-message). It is not required in requests to the API.
      tags:
        - prescribing
      parameters:
        - $ref: '#/components/parameters/BearerAuthorization'
        - $ref: '#/components/parameters/RoleId'
        - $ref: '#/components/parameters/RequestID'
        - $ref: '#/components/parameters/CorrelationID'
      requestBody:
        required: true
        content:
          application/fhir+json:
            schema:
              $ref: '#/components/schemas/Cancel-Request-Bundle'
            examples:
              prescription-order-update-success:
                description: |
                  A valid secondary care prescription-order-update message. More examples of this message can be found [here](https://simplifier.net/guide/NHSDigital-Medicines/Home/Examples/AllExamples?version=current#Home/Examples/AllExamples/Messageprescription-order-update).
                value:
                  $ref: components/examples/secondary-care/community/acute/nominated-pharmacy/clinical-practitioner/1-Process-Request-Cancel-200_OK.json
        description: ''
      responses:
        '200':
          description: |
            Successfully submitted.
            
            Note that both successful and unsuccesful cancel responses will be successfully processed.
            
            | HTTP status | Response code          | Description                                                                                                                           | FHIR type        |
            | ----------- | ---------------------- | --------------------------------------------------------------------------------------------------------------------------------------| ---------------- |
            | 200         | R-0001                 | Prescription or item was cancelled.                                                                                                       | Bundle           |
            | 200         | R-0002                 | Prescription or item was not cancelled. With dispenser. Marked for cancellation.                                                          | Bundle           |
            | 200         | R-0003                 | Prescription or item was not cancelled. With dispenser active. Marked for cancellation.                                                   | Bundle           |
            | 200         | R-0004                 | Prescription or item was not cancelled. Prescription has been dispensed.                                                                 | Bundle           |
            | 200         | R-0005                 | Prescription or item had expired.                                                                                                         | Bundle           |
            | 200         | R-0006                 | Prescription or item had already been cancelled.                                                                                          | Bundle           |
            | 200         | R-0007                 | Prescription or item cancellation requested by another prescriber.                                                                        | Bundle           |
            | 200         | R-0010                 | Prescription or item was not cancelled. Prescription has been not dispensed. 
          
          
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/schemas/Cancel-Response-Bundle'
              examples:
                bundle-success:
                  description: |
                    A successful response to a prescription-order-update request.
                  value:
                    $ref: components/examples/prescription-order-update/bundle-success.json
        '4XX':
          description: |
            An error occurred as follows:

            | HTTP status | Error code             | Description                                                                                                                           | FHIR type        |
            | ----------- | ---------------------- | --------------------------------------------------------------------------------------------------------------------------------------| ---------------- |
            | 400         | R-0008                 | Prescription or item not found.                                                                                                       |                  |
            | 400         | R-5000                 | Unable to process message due to invalid information within the cancel request.                                                       |                  |
            | 400         | BAD_REQUEST            | Invalid request.                                                                                                                      | OperationOutcome |
            | 400         | BAD_REQUEST            | Invalid request (with additional details).                                                                                            | Bundle           |
            | 400         | MISSING_FIELD          | A required field is missing within the request, see `display` field in response.                                                      |                  |
            | 400         | INVALID_VALUE          | Invalid value in message.                                                                                                             |                  |
            | 400         | INCORRECT_RESOURCETYPE | FHIR resource has an incorrect resourceType.                                                                                          |                  |
            | 401         | ACCESS_DENIED          | User does not have permission for a particular request.                                                                               |                  |
            | 403         | FORBIDDEN              | Insufficient authorization.                                                                                                           |                  |
            | 404         | NOT_FOUND              | Route not found.                                                                                                                      |                  |
            | 404         | NOT_FOUND              | Resource not found.                                                                                                                   |                  |
            | 500         | INTERNAL SERVER ERROR  | The server has encountered a situation it does not know how to handle.                                                                |                  |
            | 504         | GATEWAY_TIMEOUT        | If your request has not been fully processed within 59 seconds, you will get this response. Retry the request with identical payload. |                  |
            
            
          content:
            application/fhir+json:
              schema:
                type: object
              examples:
                OperationOutcome:
                  description: |
                    An error response.
                  value:
                    $ref: components/examples/example-a-validation-error-missing-field/Response-FhirError.json
                Bundle:
                  description: |
                    An error response with additional details provided.
                  value:
                    $ref: components/examples/prescription-order-update/bundle-error.json
  /FHIR/R4/Task/$release:
    post:
      operationId: release
      summary: Download prescriptions - Dispensing
      description: |
        ## Overview
        Use this endpoint to download prescriptions from EPS that are available for dispensing.
        You can download a single prescription using the prescription's ID,
        or download up to 25 prescriptions (per request) nominated to a dispenser using the dispenser's ODS code.

        Send a [Task-release message](https://simplifier.net/guide/NHSDigital-Medicines/Home/FHIRAssets/AllAssets/OperationDefinition-duplicate-2/release-duplicate-2) to this endpoint to download the prescription.
      tags:
        - dispensing
      parameters:
        - $ref: '#/components/parameters/BearerAuthorization'
        - $ref: '#/components/parameters/RoleId'
        - $ref: '#/components/parameters/RequestID'
        - $ref: '#/components/parameters/CorrelationID'
      requestBody:
        required: true
        content:
          application/fhir+json:
            schema:
              type: object
              description: |
                Details of which prescriptions are to be downloaded, expressed as a [Parameters FHIR resource](http://www.hl7.org/fhir/parameters.html).
                For details of the parameters, see [Task-release message](https://simplifier.net/guide/NHSDigital-Medicines/Home/FHIRAssets/AllAssets/OperationDefinition-duplicate-2/release-duplicate-2).
            examples:
              owner:
                description: |
                  A valid release request. More examples of this message can be found [here](https://simplifier.net/guide/NHSDigital-Medicines/Home/Examples/AllExamples?version=current#Home/Examples/AllExamples/OperationDefinitionrelease).
                value:
                  $ref: components/examples/secondary-care/homecare/acute/nominated-pharmacy/clinical-practitioner/1-Task-Request-Release-200_OK.json
      responses:
        '200':
          description: Successfully downloaded a prescription for dispensing.
          content:
            application/fhir+json:
              schema:
                type: object
                description: |
                  The requested prescriptions,
                  expressed as a FHIR bundle of [prescription-order FHIR messages](https://simplifier.net/guide/NHSDigital-Medicines/Home/FHIRAssets/AllAssets/MessageDefinition-duplicate-2/prescription-order).
              examples:
                example:
                  description: |
                    A successful response to a release request.
                  value:
                    $ref: components/examples/sandbox/Release-Response-200_OK.json
        '4XX':
          description: |
            An error occurred as follows:

            | HTTP status | Error code                          | Description                                                                                                                           |
            | ----------- | ----------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------- |
            | 400         | BAD_REQUEST                         | Invalid request.                                                                                                                      |
            | 400         | PRESCRIPTION_WITH_ANOTHER_DISPENSER | Prescription is with another dispenser. See OperationOutcome.issue.diagnostics for more information about owning pharmacy.            |
            | 400         | MISSING_FIELD                       | A required field is missing within the request, see `display` field in response.                                                      |
            | 400         | INVALID_VALUE                       | Invalid value in message.                                                                                                             |
            | 400         | INCORRECT_RESOURCETYPE              | FHIR resource has an incorrect resourceType.                                                                                          |
            | 401         | ACCESS_DENIED                       | User does not have permission for a particular request.                                                                               |
            | 403         | FORBIDDEN                           | Insufficient authorization.                                                                                                           |
            | 404         | NOT_FOUND                           | Route not found.                                                                                                                      |
            | 404         | NOT_FOUND                           | Resource not found.                                                                                                                   |
            | 500         | INTERNAL SERVER ERROR               | The server has encountered a situation it does not know how to handle.                                                                |
            | 504         | GATEWAY_TIMEOUT                     | If your request has not been fully processed within 59 seconds, you will get this response. Retry the request with identical payload. |
      
          content:
            application/fhir+json:
              schema:
                type: object
              examples:
                not-found:
                  description: |
                    An error response due to requested prescription not being found.
                  value:
                    $ref: components/examples/release/not-found-error.json 
                with-another-dispenser:
                  description: |
                    An error response due to the prescription being released by another dispenser.
                  value:
                    $ref: components/examples/release/with-another-dispenser-error.json 
  /FHIR/R4/$verify-signature:
    post:
      operationId: verify-signature
      summary: Verify a prescription's signature - Dispensing
      description: |
        ## Overview
        Use this endpoint to verify the signature on one or more prescriptions to ensure that the signaturs is valid,
        and that it matches the prescription it is attached to.
        This endpoint is expected to be used immediately after downloading prescriptions.
        Send the response message from the 'download prescriptions' endpoint to this endpoint.

        The endpoint will return a set of (up to 25) verify responses associated with the bundle of prescriptions sent to the endpoint for verification.
      tags:
        - dispensing
      parameters:
        - $ref: '#/components/parameters/BearerAuthorization'
        - $ref: '#/components/parameters/RequestID'
        - $ref: '#/components/parameters/CorrelationID'
      requestBody:
        required: true
        content:
          application/fhir+json:
            schema:
              type: object
              description: |
                The prescription orders to be verified, including the signatures,
                expressed as a FHIR bundle of [prescription-order FHIR messages](https://simplifier.net/guide/NHSDigital-Medicines/Home/FHIRAssets/AllAssets/MessageDefinition-duplicate-2/prescription-order).
                Use the response from the 'download prescriptions' endpoint.
            examples:
              owner:
                description: |
                  A valid signature verification request.
                value:
                  $ref: components/examples/sandbox/Release-Response-200_OK.json
      responses:
        '200':
          description: Successfully verified the prescription signature, signature may still be invalid.
          content:
            application/fhir+json:
              schema:
                type: object
              examples:
                example:
                  description: |
                    A successful response to a verify signature request, showing a failure to verify the signature as correct.
                  value:
                    $ref: components/examples/sandbox/VerifySignature-Response-200_OK.json
        '4XX':
          description: |
            An error occurred as follows:

            | HTTP status | Error code             | Description                                                                                                                           |
            | ----------- | ---------------------- | ------------------------------------------------------------------------------------------------------------------------------------- |
            | 400         | BAD_REQUEST            | Invalid request.                                                                                                                      |
            | 400         | MISSING_FIELD          | A required field is missing within the request, see `display` field in response.                                                      |
            | 400         | INVALID_VALUE          | Invalid value in message.                                                                                                             |
            | 400         | INCORRECT_RESOURCETYPE | FHIR resource has an incorrect resourceType.                                                                                          |
            | 401         | ACCESS_DENIED          | User does not have permission for a particular request.                                                                               |
            | 403         | FORBIDDEN              | Insufficient authorization.                                                                                                           |
            | 404         | NOT_FOUND              | Route not found.                                                                                                                      |
            | 404         | NOT_FOUND              | Resource not found.                                                                                                                   |
            | 500         | INTERNAL SERVER ERROR  | The server has encountered a situation it does not know how to handle.                                                                |
            | 504         | GATEWAY_TIMEOUT        | If your request has not been fully processed within 59 seconds, you will get this response. Retry the request with identical payload. |
          
          content:
            application/fhir+json:
              schema:
                type: object
              examples:
                example:
                  description: |
                    An error response to a verify signature request.
                  value:
                    $ref: components/examples/release/not-found-error.json
  /FHIR/R4/Task#return:
    post:
      operationId: return
      summary: Return a downloaded prescription - Dispensing
      description: |
        ## Overview
        Use this endpoint to return a downloaded prescription to EPS, so that another dispensing system can download it.

        The effect of calling this endpoint depends on the Task status.
        To return a downloaded prescription to EPS, send a Task with a status of `rejected`.
        For more information on how to create these messages, see [NHSDigital-Task](https://simplifier.net/guide/NHSDigital-Medicines/Home/FHIRAssets/AllAssets/Profiles/NHSDigital-Task).

        Note that the `#return` in the URL has been added to distinguish this from the other operations which
        can be performed using the `Task` endpoint. It is not required in requests to the API.
      tags:
        - dispensing
      parameters:
        - $ref: '#/components/parameters/BearerAuthorization'
        - $ref: '#/components/parameters/RoleId'
        - $ref: '#/components/parameters/RequestID'
        - $ref: '#/components/parameters/CorrelationID'
      requestBody:
        required: true
        content:
          application/fhir+json:
            schema:
              type: object
              description: The request to return a downloaded prescription, expressed as a [Task FHIR resource](https://simplifier.net/guide/NHSDigital-Medicines/Home/FHIRAssets/AllAssets/Profiles/NHSDigital-Task).
            examples:
              return:
                description: |
                  A valid request to return a prescription. More examples of this message can be found [here](https://simplifier.net/guide/NHSDigital-Medicines/Home/Examples/AllExamples?version=current#Home/Examples/AllExamples/Task).
                value:
                  $ref: components/examples/secondary-care/homecare/acute/nominated-pharmacy/clinical-practitioner/2-Task-Request-Return-200_OK.json
      responses:
        '200':
          description: Action completed successfully.
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/responses/200OperationOutcome'
              examples:
                OperationOutcome:
                  description: |
                    A successful response to a return request.
                  value:
                    $ref: components/examples/operation-outcome-success.json
        '4XX':
          description: |
            An error occurred as follows:

            | HTTP status | Error code             | Description                                                                                                                           |
            | ----------- | -----------------------| ------------------------------------------------------------------------------------------------------------------------------------- |
            | 400         | BAD_REQUEST            | Invalid request.                                                                                                                      |
            | 400         | MISSING_FIELD          | A required field is missing within the request, see `display` field in response.                                                      |
            | 400         | INVALID_VALUE          | Invalid value in message.                                                                                                             |
            | 400         | INCORRECT_RESOURCETYPE | FHIR resource has an incorrect resourceType.                                                                                          |
            | 401         | ACCESS_DENIED          | User does not have permission for a particular request.                                                                               |
            | 403         | FORBIDDEN              | Insufficient authorization.                                                                                                           |
            | 404         | NOT_FOUND              | Route not found.                                                                                                                      |
            | 404         | NOT_FOUND              | Resource not found.                                                                                                                   |
            | 500         | INTERNAL SERVER ERROR  | The server has encountered a situation it does not know how to handle.                                                                |
            | 504         | GATEWAY_TIMEOUT        | If your request has not been fully processed within 59 seconds, you will get this response. Retry the request with identical payload. |
            
          content:
            application/fhir+json:
              examples:
                example:
                  description: |
                    An error response to a return request.
                  value:
                    $ref: components/examples/release/not-found-error.json
  /FHIR/R4/$process-message#dispense-notification:
    post:
      operationId: send-dispense-notification-message
      summary: Mark a prescription as dispensed - Dispensing
      description: |
        ## Overview
        ### Dispense notification
        Use this endpoint to send a dispense notification to EPS.

        The effect of calling this endpoint depends on the type of the message, which is determined by the `MessageHeader` resource.
        To mark a prescription as partially or fully dispensed, send a [dispense-notification message](https://simplifier.net/guide/NHSDigital-Medicines/Home/FHIRAssets/AllAssets/MessageDefinition-duplicate-2/dispense-notification).

        Note that the `#dispense-notification` in the URL has been added to distinguish this from the other operations which
        can be performed using the [`$process-message` endpoint](https://simplifier.net/guide/NHSDigital/Home/FHIRAssets/AllAssets/OperationDefinition/process-message). It is not required in requests to the API.
        
        ### Amend dispense notification
        The same endpoint can be used to amend a previous dispense notification. The same message structure is used with the addition of a `replacementOf` extension in the MessageHeader,
        referencing the identifier of the previous dispense notifcation to be amended. Only the most recent dispense notification can be amended. To amend other dispense notifications please use the Withdraw endpoint, to withdraw all dispense notifications issued after the amend target, and then amend if necessary.
        
        More information can be found on the fhir [documentation](https://simplifier.net/guide/NHSDigital/Home/FHIRAssets/AllAssets/Profiles/NHSDigital-MessageHeader).
      tags:
        - dispensing
      parameters:
        - $ref: '#/components/parameters/BearerAuthorization'
        - $ref: '#/components/parameters/RoleId'
        - $ref: '#/components/parameters/RequestID'
        - $ref: '#/components/parameters/CorrelationID'
      requestBody:
        required: true
        content:
          application/fhir+json:
            schema:
              type: object
              description: |
                The dispense notification, amendment to a previous dispense notification, expressed as a [dispense-notification FHIR message](https://simplifier.net/guide/NHSDigital-Medicines/Home/FHIRAssets/AllAssets/MessageDefinition-duplicate-2/dispense-notification).
                If amending a previous dispense notification, include the `replacementOf` extension.
            examples:
              dispense-notification-success:
                description: |
                  A valid secondary care dispense-notification message. More examples of this message can be found [here](https://simplifier.net/guide/NHSDigital-Medicines/Home/Examples/AllExamples?version=current#Home/Examples/AllExamples/Messagedispense-notification).
                value:
                  $ref: components/examples/secondary-care/homecare/acute/nominated-pharmacy/clinical-practitioner/1-Process-Request-Dispense-200_OK.json
        description: ''
      responses:
        '200':
          description: Successfully submitted.
          content:
            application/fhir+json:
              schema:
                type: object
              examples:
                operation-outcome-success:
                  description: |
                    A successful response to a dispense-notification.
                  value:
                    $ref: components/examples/operation-outcome-success.json
        '4XX':
          description: |
            An error occurred as follows:

            | HTTP status | Error code             | Description                                                                                                                           |
            | ----------- | -----------------------| ------------------------------------------------------------------------------------------------------------------------------------- |
            | 400         | BAD_REQUEST            | Invalid request.                                                                                                                      |
            | 400         | MISSING_FIELD          | A required field is missing within the request, see `display` field in response.                                                      |
            | 400         | INVALID_VALUE          | Invalid value in message.                                                                                                             |
            | 400         | INCORRECT_RESOURCETYPE | FHIR resource has an incorrect resourceType.                                                                                          |
            | 401         | ACCESS_DENIED          | User does not have permission for a particular request.                                                                               |
            | 403         | FORBIDDEN              | Insufficient authorization.                                                                                                           |
            | 404         | NOT_FOUND              | Route not found.                                                                                                                      |
            | 404         | NOT_FOUND              | Resource not found.                                                                                                                   |
            | 500         | INTERNAL SERVER ERROR  | The server has encountered a situation it does not know how to handle.                                                                |
            | 504         | GATEWAY_TIMEOUT        | If your request has not been fully processed within 59 seconds, you will get this response. Retry the request with identical payload. |
            
          content:
            application/fhir+json:
              schema:
                type: object
              examples:
                OperationOutcome:
                  description: |
                    An error response.
                  value:
                    $ref: components/examples/example-a-validation-error-missing-field/Response-FhirError.json
  /FHIR/R4/Task#withdraw:
    post:
      operationId: withdraw
      summary: Withdraw a dispense notification - Dispensing
      description: |
        ## Overview
        Use this endpoint to withdraw a dispense notification, for example in the case that a prescription was marked as dispensed erroneously.

        The effect of calling this endpoint depends on the Task status.
        To withdraw a dispense notification from EPS, send a Task with a status of `in-progress`.
        For more information on how to create these messages, see [NHSDigital-Task](https://simplifier.net/guide/NHSDigital-Medicines/Home/FHIRAssets/AllAssets/Profiles/NHSDigital-Task).

        Note that the `#withdraw` in the URL has been added to distinguish this from the other operations which
        can be performed using the `Task` endpoint. It is not required in requests to the API.

        This interaction is only available in the sandbox environment.
      tags:
        - dispensing
      parameters:
        - $ref: '#/components/parameters/BearerAuthorization'
        - $ref: '#/components/parameters/RoleId'
        - $ref: '#/components/parameters/RequestID'
        - $ref: '#/components/parameters/CorrelationID'
      requestBody:
        required: true
        content:
          application/fhir+json:
            schema:
              type: object
              description: The request to withdraw a dispense notification, expressed as a [Task FHIR resource](https://simplifier.net/guide/NHSDigital-Medicines/Home/FHIRAssets/AllAssets/Profiles/NHSDigital-Task).
            examples:
              withdraw:
                description: |
                  A valid request to withdraw a dispense notification. More examples of this message can be found [here](https://simplifier.net/guide/NHSDigital-Medicines/Home/Examples/AllExamples?version=current#Home/Examples/AllExamples/Task).
                value:
                  $ref: components/examples/secondary-care/homecare/acute/nominated-pharmacy/clinical-practitioner/3-Task-Request-Withdraw-200_OK.json
      responses:
        '200':
          description: Action completed successfully.
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/responses/200OperationOutcome'
              examples:
                OperationOutcome:
                  description: |
                    A successful response to a withdraw request.
                  value:
                    $ref: components/examples/operation-outcome-success.json
        '4XX':
          description: |
            An error occurred as follows:

            | HTTP status | Error code             | Description                                                                                                                           |
            | ----------- | ---------------------- | ------------------------------------------------------------------------------------------------------------------------------------- |
            | 400         | BAD_REQUEST            | Invalid request.                                                                                                                      |
            | 400         | MISSING_FIELD          | A required field is missing within the request, see `display` field in response.                                                      |
            | 400         | INVALID_VALUE          | Invalid value in message.                                                                                                             |
            | 400         | INCORRECT_RESOURCETYPE | FHIR resource has an incorrect resourceType.                                                                                          |
            | 401         | ACCESS_DENIED          | User does not have permission for a particular request.                                                                               |
            | 403         | FORBIDDEN              | Insufficient authorization.                                                                                                           |
            | 404         | NOT_FOUND              | Route not found.                                                                                                                      |
            | 404         | NOT_FOUND              | Resource not found.                                                                                                                   |
            | 500         | INTERNAL SERVER ERROR  | The server has encountered a situation it does not know how to handle.                                                                |
            | 504         | GATEWAY_TIMEOUT        | If your request has not been fully processed within 59 seconds, you will get this response. Retry the request with identical payload. |
            
          content:
            application/fhir+json:
              examples:
                example:
                  description: |
                    An error response to a withdraw request.
                  value:
                    $ref: components/examples/release/not-found-error.json
  /FHIR/R4/Claim:
    post:
      operationId: send-dispense-claim-message
      summary: Claim for a dispensed prescription - Dispensing
      description: |
        ## Overview
        ### Claim
        Use this endpoint to submit a claim for reimbursement for a dispensed prescription.
        ### Claim amendment
        The same endpoint can be used to amend a previous claim. The same message structure is used with the addition of a `replacementOf` extension 
        referencing the identifier of the previous claim to be amended. 
        More information can be found on the fhir [documentation](https://simplifier.net/guide/NHSDigital-Medicines/Home/FHIRAssets/AllAssets/Profiles/NHSDigital-Claim).
      tags:
        - dispensing
      parameters:
        - $ref: '#/components/parameters/BearerAuthorization'
        - $ref: '#/components/parameters/RoleId'
        - $ref: '#/components/parameters/RequestID'
        - $ref: '#/components/parameters/CorrelationID'
      requestBody:
        required: true
        content:
          application/fhir+json:
            schema:
              type: object
              description: |
                The claim to be submitted or amended, expressed as a [Claim FHIR resource](https://simplifier.net/guide/NHSDigital-Medicines/Home/FHIRAssets/AllAssets/Profiles/NHSDigital-Claim).
                If amending a claim, include the `replacementOf` extension.
            examples:
              dispense-claim-success:
                description: |
                  A valid secondary care Claim message. More examples of this message can be found [here](https://simplifier.net/guide/NHSDigital-Medicines/Home/Examples/AllExamples?version=current#Home/Examples/AllExamples/Claim).
                value:
                  $ref: components/examples/secondary-care/homecare/acute/nominated-pharmacy/clinical-practitioner/4-Claim-Request-200_OK.json
        description: ''
      responses:
        '200':
          description: Successfully submitted.
          content:
            application/fhir+json:
              schema:
                type: object
              examples:
                operation-outcome-success:
                  description: |
                    A successful response to a dispense-claim request.
                  value:
                    $ref: components/examples/operation-outcome-success.json
        '4XX':
          description: |
            An error occurred as follows:

            | HTTP status | Error code             | Description                                                                                                                           |
            | ----------- | ---------------------- | ------------------------------------------------------------------------------------------------------------------------------------- |
            | 400         | BAD_REQUEST            | Invalid request.                                                                                                                      |
            | 400         | MISSING_FIELD          | A required field is missing within the request, see `display` field in response.                                                      |
            | 400         | INVALID_VALUE          | Invalid value in message.                                                                                                             |
            | 400         | INCORRECT_RESOURCETYPE | FHIR resource has an incorrect resourceType.                                                                                          |
            | 401         | ACCESS_DENIED          | User does not have permission for a particular request.                                                                               |
            | 403         | FORBIDDEN              | Insufficient authorization.                                                                                                           |
            | 404         | NOT_FOUND              | Route not found.                                                                                                                      |
            | 404         | NOT_FOUND              | Resource not found.                                                                                                                   |
            | 500         | INTERNAL SERVER ERROR  | The server has encountered a situation it does not know how to handle.                                                                |
            | 504         | GATEWAY_TIMEOUT        | If your request has not been fully processed within 59 seconds, you will get this response. Retry the request with identical payload. |
            
          content:
            application/fhir+json:
              schema:
                type: object
              examples:
                OperationOutcome:
                  description: |
                    An error response.
                  value:
                    $ref: components/examples/example-a-validation-error-missing-field/Response-FhirError.json
  /FHIR/R4/Task:
    get:
      operationId: get-task
      summary: Search for summary details about a prescription
      description: |
        ## Overview
        Use this endpoint to search for summary details about one or more prescriptions.
        
        At least one of the following query parameters must be provided:
        * identifier
        * focus:identifier
        * patient:identifier
        
        You can also search on the following parameters:
        * business-status
        * authored-on
      tags:
        - tracker
      parameters:
        - $ref: '#/components/parameters/BearerAuthorization'
        - $ref: '#/components/parameters/RoleId'
        - $ref: '#/components/parameters/RequestID'
        - $ref: '#/components/parameters/CorrelationID'
        - $ref: '#/components/parameters/Identifier'
        - $ref: '#/components/parameters/FocusIdentifier'
        - $ref: '#/components/parameters/PatientIdentifier'
        - $ref: '#/components/parameters/BusinessStatus'
        - $ref: '#/components/parameters/AuthoredOn'
      responses:
        '200':
          description: Successful query.
          content:
            application/fhir+json:
              schema:
                type: object
              examples:
                example:
                  description: |
                    A successful response to a prescription summary query. More examples of this message can be found [here](https://simplifier.net/guide/NHSDigital-Medicines/Home/Examples/AllExamples?version=current#Home/Examples/AllExamples/Task).
                  value:
                    $ref: 'components/examples/task/success.json'
        '4XX':
          description: Invalid query.
          content:
            application/fhir+json:
              schema:
                $ref: '#/components/schemas/operation-outcome'
              examples:
                example:
                  description: |
                    An error response to a prescription summary query.
                  value:
                    $ref: 'components/examples/task/query-error.json'
components:
  parameters:
    BearerAuthorization:
      in: header
      name: Authorization
      description: |
        An [OAuth 2.0 bearer token](https://digital.nhs.uk/developer/guides-and-documentation/security-and-authorisation#user-restricted-apis).

        Required in all environments except sandbox.
      required: true
      schema:
        type: string
        format: '^Bearer\ [[:ascii:]]+$'
        example: 'Bearer g1112R_ccQ1Ebbb4gtHBP1aaaNM'
    RoleId:
      in: header
      name: NHSD-Session-URID
      description: |
        The user role ID (URID) for the current session. Also known as a user role profile ID (URPID).

        If you are using User-restricted RESTful APIs - NHS login separate authentication and authorisation, see [determine the user's role](https://digital.nhs.uk/developer/guides-and-documentation/security-and-authorisation/user-restricted-restful-apis-nhs-cis2-separate-authentication-and-authorisation#step-9-determine-the-user-s-role) for guidance.

        This field is optional.
      required: false
      schema:
        type: string
        pattern: '^[0-9]+$'
        example: '555254240100'
    RequestID:
      in: header
      name: X-Request-ID
      required: true
      description: |
        A globally unique identifier (GUID) for the request, which we use to de-duplicate repeated requests and to trace the request if you contact our helpdesk.

        Must be a universally unique identifier (UUID) (ideally version 4).
        
        Mirrored back in a response header.
        
        If you re-send a failed request, use the same value in this header.
        
        Required in all environments except sandbox.
      schema:
        type: string
        pattern: '^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$'
        example: 60E0B220-8136-4CA5-AE46-1D97EF59D068
    CorrelationID:
      in: header
      name: X-Correlation-ID
      required: false
      description: |
        An optional ID which you can use to track transactions across multiple systems. It can have any value, but we recommend avoiding `.` characters.

        Mirrored back in a response header.
      schema:
        type: string
        example: 11C46F5F-CDEF-4865-94B2-0EE0EDCC26DA
    Identifier:
      in: query
      name: identifier
      description: |
        The short form identifier of the prescription you are searching for.
      required: false
      schema:
        type: string
        example: 'D7AC09-A99968-4BA59C'
    FocusIdentifier:
      in: query
      name: focus:identifier
      description: |
        The short form identifier of the prescription you are searching for.
      required: false
      schema:
        type: string
    PatientIdentifier:
      in: query
      name: patient:identifier
      description: |
        The NHS number of the patient whose prescriptions you are searching for.
      required: false
      schema:
        type: string
        example: '9912003489'
    BusinessStatus:
      in: query
      name: business-status
      description: |
        The state that a prescription is in. You can find valid business states [here](https://simplifier.net/packages/uk.nhsdigital.medicines.r4/2.1.14-alpha/files/374928).
      required: false
      schema:
        type: string
        example: '0001'
    AuthoredOn:
      in: query
      name: authored-on
      description: Date the prescription was authored `<eq|ge|le>yyyy-mm-dd`. To specify a range, use `authored-on=geyyyy-mm-dd&authored-on=leyyyy-mm-dd`.
      examples:
        simple:
          value:
            - eq2010-10-22
          description: Exact match date
        rangege:
          value:
            - ge2010-10-22
          description: Greater than or equals match, which matches 2010-10-22 or 2010-10-23
        rangele:
          value:
            - le2010-10-22
          description: Less than or equals match, which matches 2010-10-22 or 2010-10-21 
      required: false
      schema:
        type: string
        example: 'date=ge2010-01-01&date=le2011-12-31'
  responses:
    200OperationOutcome:
      description: A successful response.
      content:
        application/fhir+json:
          schema:
            type: object
            description: |
              Outcome of an operation that does not result in a resource or bundle being returned (such as error, async/batch submission).
            properties:
              resourceType:
                type: string
                description: FHIR Resource Type.
                enum:
                  - "OperationOutcome"
                example: "OperationOutcome"
              issue:
                type: array
                description: List of issues that have occurred.
                minItems: 1
                items:
                  type: object
                  required:
                    - severity
                    - code
                  properties:
                    severity:
                      type: string
                      enum: [ "information" ]
                      description: Severity of the error.
                      example: "information"
                    code:
                      type: string
                      enum: [ "informational" ]
                      description: FHIR error code.
                      example: "informational"
                    diagnostics:
                      type: string
                      example: "Message Sent"
  schemas:
    
    operation-outcome:
      type: object
      description: |
        Outcome of an operation that does not result in a resource or bundle being returned (for example, error, async/batch submission).
      properties:
        resourceType:
          type: string
          description: FHIR Resource Type.
          enum:
            - "OperationOutcome"
          example: "OperationOutcome"
        issue:
          type: array
          description: List of issues that have occurred.
          minItems: 1
          items:
            type: object
            required:
              - severity
              - code
            properties:
              severity:
                type: string
                enum: ["fatal", "error", "warning", "information"]
                description: Severity of the error.
                example: "error"
              code:
                type: string
                description: FHIR error code.
                example: "invalid"
                enum:
                  - "invalid"
                  - "structure"
                  - "required"
                  - "value"
                  - "invariant"
                  - "security"
                  - "login"
                  - "unknown"
                  - "expired"
                  - "forbidden"
                  - "suppressed"
                  - "processing"
                  - "not-supported"
                  - "duplicate"
                  - "multiple-matches"
                  - "not-found"
                  - "deleted"
                  - "too-long"
                  - "code-invalid"
                  - "extension"
                  - "too-costly"
                  - "business-rule"
                  - "conflict"
                  - "transient"
                  - "lock-error"
                  - "no-store"
                  - "exception"
                  - "timeout"
                  - "incomplete"
                  - "throttled"
                  - "informational"
              details:
                $ref: '#/components/schemas/ErrorCode.yaml'
              expression:
                type: string
                description: FHIRPath of element(s) related to the error.
                example: "Patient.name.given"
    parameters-response:
      type: object
      description: A response from the /$prepare endpoint.
      properties:
        resourceType:
          type: string
          enum:
            - "Parameters"
        parameter:
          type: array
          items: 
            oneOf:
              - type: object
                properties:
                  name:
                    type: string
                    enum: 
                      - "digest"
                  valueString:
                    type: string
                    example: "PFNpZ25lZEluZm8geG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyMiPjxDYW5vbmljYWxpemF0aW9uTWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8xMC94bWwtZXhjLWMxNG4jIj48L0Nhbm9uaWNhbGl6YXRpb25NZXRob2Q+PFNpZ25hdHVyZU1ldGhvZCBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyNyc2Etc2hhMSI+PC9TaWduYXR1cmVNZXRob2Q+PFJlZmVyZW5jZT48VHJhbnNmb3Jtcz48VHJhbnNmb3JtIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8xMC94bWwtZXhjLWMxNG4jIj48L1RyYW5zZm9ybT48L1RyYW5zZm9ybXM+PERpZ2VzdE1ldGhvZCBBbGdv"
                    description: "The Prescription Information that requires signing."
              - type: object
                properties:
                  name:
                    type: string
                    enum:
                      - "timestamp"
                  valueString:
                    type: string
                    format: date-time
                    example: "2021-05-07T14:47:47+00:00"
              - type: object
                properties:
                  name:
                    type: string
                    enum: 
                      - "algorithm"
                  valueString:
                    type: string
                    enum:
                      - "RS1"
    ErrorCode.yaml:
      type: object
      description: Internal error code.
      properties:
        coding:
          type: array
          items:
            type: object
            properties:
              system:
                type: string
                description: URI of the coding system specification.
                example: https://fhir.nhs.uk/R4/CodeSystem/Spine-ErrorOrWarningCode
              version:
                type: string
                description: Version of the coding system in use.
                example: '1'
              code:
                type: string
                description: Symbol in syntax defined by the system.
                example: INVALID_VALUE
              display:
                type: string
                description: Representation defined by the system.
                example: Provided value is invalid
  
    extension-prescriptionEndorsement.yaml:
      type: object
      description: |
        Endorsements that prescribers can add to line items for special products, e.g. products on the Selected List Scheme. 
        
        You can view the latest guidance on endorsements from the BSA [here](https://www.nhsbsa.nhs.uk/sites/default/files/2022-07/NHSBSAGuidanceforEndorsement_v7.7.pdf).
      properties:
        url:
          type: string
          description: URL of the extension definition. 
          enum:
            - https://fhir.nhs.uk/StructureDefinition/Extension-DM-PrescriptionEndorsement
        valueCodeableConcept:
          type: object
          properties:
            coding: 
              type: array
              items:
                type: object
                properties:
                  system:
                    type: string
                    description: codesystem URL for endorsements
                    enum: 
                      - https://fhir.nhs.uk/CodeSystem/medicationrequest-endorsement 
                  code:
                    type: string
                    description: The endorsement code
                    enum:
                      - ACBS
                      - AF
                      - CC
                      - FS
                      - SLS
    extension-DM-ResponsiblePractitioner.yaml:
      type: object
      description: A reference to the responsible party of a prescription, where they are distinct to the prescriber who authored the prescription.
      properties:
        url:
          type: string
          description: URL of the extension definition. 
          enum:
            - https://fhir.nhs.uk/StructureDefinition/Extension-DM-ResponsiblePractitioner
        valueReference:
          type: object
          properties:
            reference:
              type: string
              description: A reference to a PractitionerRole resource within the Bundle
              example: urn:uuid:a5acefc1-f8ca-4989-a5ac-34ae36741466
            display: 
              type: string
              description: The name of the responsible party
              example: Dr. James Smith
    extension-controlledDrug.yaml:
      type: object
      description: The quantity of a controlled drug, expressed in words
      properties:
        url:
          type: string
          description: URL of the extension definition. 
          enum:
            - https://fhir.nhs.uk/StructureDefinition/Extension-DM-ControlledDrug
        extension:
          type: array
          description: a FHIR extension array.
          items:
            oneOf:
              - type: object
                description: object containing the quantity in words
                properties:
                  url:
                    type: string
                    description: URL for the controlled drug quantity
                    enum:
                      - "quantityWords"
                  valueString:
                    type: string
                    description: quantity expressed in words
                    example: "twenty eight"
              - type: object
                description: object containing the schedule of the controlled drug
                properties:
                  url:
                    type: string
                    description: URL for the controlled drug schedule
                    enum:
                      - "schedule"
                  valueCoding:
                    type: object
                    properties:
                      system:
                        type: string
                        description: codesystem to identify the controlled drug schedule
                        enum:
                          - https://fhir.nhs.uk/CodeSystem/medicationrequest-controlled-drug
                      code:
                        type: string
                        description: a code to identify the controlled drug schedule
                        enum:
                          - CD1
                          - CD2
                          - CD3
                          - CD4
                          - CD5
                      display:
                        type: string
                        description: a human readable display to accompany the controlled drug schedule code
                        example: Schedule 2
    extension-NHSBSAPrescriptionType.yaml:
      type: object
      description: |
        The prescription type, as defined by the BSA, which helps identify the prescribing setting in which a prescription is created to enable reimbursement.
      
        For the full list of prescription types, and what they mean, please refer to the following [guidance](https://www.nhsbsa.nhs.uk/sites/default/files/2022-07/NHSBSAGuidanceforEndorsement_v7.7.pdf) from the BSA.
        
        Where the prescription type is of the pattern 01nn, the details of the prescribing organisation must be captured within the Organisation resource.
        
        Where the prescription type is of the pattern 1nnn, the details of the prescribing organisation must be captured within a HealthcareService resource.
      properties:
        url:
          type: string
          description: URL of the extension definition. 
          enum:
            - https://fhir.nhs.uk/StructureDefinition/Extension-DM-PrescriptionType
        valueCoding:
          type: object
          description: |
            The prescription type, as defined by the BSA, which helps identify the prescribing setting in which a prescription is created to enable reimbursement.
          properties:
            system: 
              type: string
              description: codesystem URL for the prescription type
              enum: 
                - https://fhir.nhs.uk/CodeSystem/prescription-type
            code:
              type: string
              description: The prescription type code
              example: "0101"
            display:
              type: string
              description: The display that accompanies the prescription type code
              example: Primary Care Prescriber - Medical Prescriber
    extension-medicationRepeatInformation.yaml:
      type: object
      description: Extension that contains information pertinent to repeat and eRD prescriptions.
      properties:
        url:
          type: string
          description: URL of the extension definition. 
          enum:
            - https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicationRepeatInformation
        extension:
          type: array
          description: a FHIR extension array.
          items:
            type: object
            properties:
              url: 
                type: string
                description: |
                  The review date of the prescription
      
                  This is a required field for repeat and eRD prescriptions, and captures the date at which the prescriber must review the repeat medication that a patient is on.
                enum: 
                  - "authorisationExpiryDate"
              valueDateTime:
                type: string
                description: A date value
                example: "2022-12-07"
    extension-cancelResponseReasons.yaml:
      type: object
      description: cancel response for a successful or unsuccessful cancel request. 
      properties:
        url:
          type: string
          description: codesystem URL for cancel responses.
          enum:
            - "https://fhir.nhs.uk/StructureDefinition/Extension-DM-PrescriptionTaskStatusReason" 
        extension:
          type: array
          description: FHIR extension array
          items:
            oneOf:
            -  type: object
               properties:
                url:
                  type: string
                  enum:
                    - "status"
                valueCoding:
                  type: object
                  properties: 
                    system:
                      type: string
                      description: codesystem URL for cancel response.
                      enum:
                        - "https://fhir.nhs.uk/CodeSystem/medicationrequest-status-history"
                    code:
                      type: string
                      description: cancel response code
                      example:
                        - "R-0001"
                    display:
                      type: string
                      description: cancel response display
                      example:
                        - "Prescription/item was cancelled"
            -  type: object
               properties:
                url:
                  type: string
                  description: URL to identify the time that the cancel response was received
                  enum:
                    - "statusdate"
                valueDateTime:
                  type: string
                  description: The time that the cancel response was received
                  example: "2022-08-23T22:21:07+00:00"
                  
    Encode-Request-Bundle:
      type: object
      description: A FHIR Bundle.
      properties:
        resourceType:
          type: string
          description: FHIR resource type.
          default: "Bundle"
        id:
          type: string
          description: object ID for the Bundle.
          enum:
            - "164996aa-29eb-4f14-a5ac-4b556a7baf6e"
        identifier:
          type: object
          properties:
            system:
              type: string
              description: codesystem URL for identifiers
              enum:
                - "https://tools.ietf.org/html/rfc4122"
            value:
              type: string
              description: The X-Request ID for the message.
              example: "164996aa-29eb-4f14-a5ac-4b556a7baf6e"
        type:
          type: string
          description: The type of payload being carried within the Bundle.
          enum:
            - "message"
        entry:
          type: array
          items:
            anyOf:
            - $ref: "#/components/schemas/Create-MedicationRequest-Resource"
            - $ref: "#/components/schemas/Create-PractitionerRole-Resource"
            - $ref: "#/components/schemas/Create-Practitioner-Resource"
            oneOf: 
            - $ref: "#/components/schemas/Create-MessageHeader-Resource"
            - $ref: "#/components/schemas/Create-Patient-Resource"
            - $ref: "#/components/schemas/Create-HealthcareService-Resource"
            - $ref: "#/components/schemas/Create-Location-Resource"
            - $ref: "#/components/schemas/Create-Organization-Resource"
            - $ref: "#/components/schemas/Create-CommunicationRequest-Resource"
            - $ref: "#/components/schemas/Create-List-Resource"
    Create-Request-Bundle:
      type: object
      description: A FHIR Bundle.
      properties:
        resourceType:
          type: string
          description: FHIR resource type.
          default: "Bundle"
        id:
          type: string
          description: An object ID for the Bundle.
          enum:
            - "164996aa-29eb-4f14-a5ac-4b556a7baf6e"
        identifier:
          type: object
          properties:
            system:
              type: string
              description: codesystem URL for identifiers
              enum:
                - "https://tools.ietf.org/html/rfc4122"
            value:
              type: string
              description: The X-Request ID for the message.
              example: "164996aa-29eb-4f14-a5ac-4b556a7baf6e"
        type:
          type: string
          description: The type of payload being carried within the Bundle.
          enum:
            - "message"
        entry:
          type: array
          items:
            anyOf:
            - $ref: "#/components/schemas/Create-MedicationRequest-Resource"
            - $ref: "#/components/schemas/Create-PractitionerRole-Resource"
            - $ref: "#/components/schemas/Create-Practitioner-Resource"
            oneOf:
            - $ref: "#/components/schemas/Create-MessageHeader-Resource"
            - $ref: "#/components/schemas/Create-Patient-Resource"
            - $ref: "#/components/schemas/Create-HealthcareService-Resource"
            - $ref: "#/components/schemas/Create-Location-Resource"
            - $ref: "#/components/schemas/Create-Organization-Resource"
            - $ref: "#/components/schemas/Create-CommunicationRequest-Resource"
            - $ref: "#/components/schemas/Create-List-Resource"
            - $ref: "#/components/schemas/Create-Provenance-Resource"
    Cancel-Request-Bundle:
      type: object
      description: A FHIR Bundle.
      properties:
        resourceType:
          type: string
          description: FHIR resource type.
          default: "Bundle"
        id:
          type: string
          description: An object ID for the Bundle.
          enum:
            - "164996aa-29eb-4f14-a5ac-4b556a7baf6e"
        identifier:
          type: object
          properties:
            system:
              type: string
              description: codesystem URL for identifiers
              enum:
                - "https://tools.ietf.org/html/rfc4122"
            value:
              type: string
              description: The X-Request ID for the message.
              example: "164996aa-29eb-4f14-a5ac-4b556a7baf6e"
        type:
          type: string
          description: The type of payload being carried within the Bundle.
          enum:
            - "message"
        entry:
          type: array
          items:
            oneOf:
            - $ref: "#/components/schemas/Cancel-Request-MessageHeader-Resource"
            - $ref: "#/components/schemas/Cancel-Request-MedicationRequest-Resource"
            - $ref: "#/components/schemas/Cancel-Request-Patient-Resource"
            - $ref: "#/components/schemas/Cancel-Request-HealthcareService-Resource"
            - $ref: "#/components/schemas/Cancel-Request-Location-Resource"
            - $ref: "#/components/schemas/Cancel-Request-Organization-Resource"
            - $ref: "#/components/schemas/Cancel-Request-CommunicationRequest-Resource"
            - $ref: "#/components/schemas/Cancel-Request-List-Resource"
            anyOf:
            - $ref: "#/components/schemas/Cancel-Request-PractitionerRole-Resource"
            - $ref: "#/components/schemas/Cancel-Request-Practitioner-Resource"
    Cancel-Response-Bundle:
      type: object
      description: A FHIR Bundle.
      properties:
        resourceType:
          type: string
          description: FHIR resource type.
          default: "Bundle"
        id:
          type: string
          description: An object ID for the Bundle.
          enum:
            - "164996aa-29eb-4f14-a5ac-4b556a7baf6e"
        identifier:
          type: object
          properties:
            system:
              type: string
              description: codesystem URL for identifiers
              enum:
                - "https://tools.ietf.org/html/rfc4122"
            value:
              type: string
              description: The X-Request ID for the message.
              example: "164996aa-29eb-4f14-a5ac-4b556a7baf6e"
        type:
          type: string
          description: The type of payload being carried within the Bundle.
          enum:
            - "message"
        entry:
          type: array
          items:
            oneOf:
            - $ref: "#/components/schemas/Cancel-Response-MedicationRequest-Resource"
            - $ref: "#/components/schemas/Cancel-Response-MessageHeader-Resource"
            - $ref: "#/components/schemas/Cancel-Response-Patient-Resource"
            anyOf:
            - $ref: "#/components/schemas/Cancel-Response-PractitionerRole-Resource"
            - $ref: "#/components/schemas/Cancel-Response-Practitioner-Resource"
            - $ref: "#/components/schemas/Cancel-Response-HealthcareService-Resource"
            - $ref: "#/components/schemas/Cancel-Response-Location-Resource"
            - $ref: "#/components/schemas/Cancel-Response-Organization-Resource"
            - $ref: "#/components/schemas/Cancel-Response-CommunicationRequest-Resource"
            - $ref: "#/components/schemas/Cancel-Response-List-Resource"
    
    Create-MessageHeader-Resource:
      type: object
      properties: 
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          type: object
          properties:
          $ref: "#/components/schemas/Create-MessageHeader"
    Create-MedicationRequest-Resource:
      type: object
      properties: 
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49bb6"
        resource:
          type: object
          properties:
          $ref: "#/components/schemas/Create-MedicationRequest"
    Create-Patient-Resource:
      type: object
      properties: 
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          type: object
          properties:
          $ref: "#/components/schemas/Create-Patient"
    Create-PractitionerRole-Resource:
      type: object
      properties: 
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          type: object
          properties:
          $ref: "#/components/schemas/Create-PractitionerRole"
    Create-Practitioner-Resource:
      type: object
      properties: 
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          type: object
          properties:
          $ref: "#/components/schemas/Create-Practitioner"
    Create-HealthcareService-Resource:
      type: object
      properties: 
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          type: object
          properties:
          $ref: "#/components/schemas/Create-HealthcareService"
    Create-Organization-Resource:
      type: object
      properties: 
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          type: object
          properties:
          $ref: "#/components/schemas/Create-Organization"
    Create-List-Resource:
      type: object
      properties: 
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          type: object
          properties:
          $ref: "#/components/schemas/Create-List"
    Create-CommunicationRequest-Resource:
      type: object
      properties: 
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          type: object
          properties:
          $ref: "#/components/schemas/Create-CommunicationRequest"
    Create-Location-Resource:
      type: object
      properties: 
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          type: object
          properties:
          $ref: "#/components/schemas/Create-Location"
    Create-Provenance-Resource:
      type: object
      properties: 
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          type: object
          properties:
          $ref: "#/components/schemas/Create-Provenance"
    
    Cancel-Request-MessageHeader-Resource:
      type: object
      properties: 
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          type: object
          properties:
          $ref: "#/components/schemas/Cancel-Request-MessageHeader"
    Cancel-Request-MedicationRequest-Resource:
      type: object
      properties: 
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          type: object
          properties:
          $ref: "#/components/schemas/Cancel-Request-MedicationRequest"
    Cancel-Request-Patient-Resource:
      type: object
      properties: 
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          type: object
          properties:
          $ref: "#/components/schemas/Cancel-Request-Patient"
    Cancel-Request-PractitionerRole-Resource:
      type: object
      properties: 
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          type: object
          properties:
          $ref: "#/components/schemas/Cancel-Request-PractitionerRole"
    Cancel-Request-Practitioner-Resource:
      type: object
      properties: 
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          type: object
          properties:
          $ref: "#/components/schemas/Cancel-Request-Practitioner"
    Cancel-Request-HealthcareService-Resource:
      type: object
      properties: 
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          type: object
          properties:
          $ref: "#/components/schemas/Create-HealthcareService"
    Cancel-Request-Organization-Resource:
      type: object
      properties: 
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          type: object
          properties:
          $ref: "#/components/schemas/Create-Organization"
    Cancel-Request-List-Resource:
      type: object
      properties: 
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          type: object
          properties:
          $ref: "#/components/schemas/Create-List"
    Cancel-Request-CommunicationRequest-Resource:
      type: object
      properties: 
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          type: object
          properties:
          $ref: "#/components/schemas/Create-CommunicationRequest"
    Cancel-Request-Location-Resource:
      type: object
      properties: 
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          type: object
          properties:
          $ref: "#/components/schemas/Create-Location"
    
    Cancel-Response-MessageHeader-Resource:
      type: object
      properties: 
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          type: object
          properties:
          $ref: "#/components/schemas/Cancel-Response-MessageHeader"
    Cancel-Response-MedicationRequest-Resource:
      type: object
      properties: 
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          type: object
          properties:
          $ref: "#/components/schemas/Cancel-Response-MedicationRequest"
    Cancel-Response-Patient-Resource:
      type: object
      properties: 
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          type: object
          properties:
          $ref: "#/components/schemas/Create-Patient"
    Cancel-Response-Practitioner-Resource:
      type: object
      properties: 
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          type: object
          properties:
          $ref: "#/components/schemas/Cancel-Response-Practitioner"
    Cancel-Response-PractitionerRole-Resource:
      type: object
      properties: 
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          type: object
          properties:
          $ref: "#/components/schemas/Cancel-Response-PractitionerRole"
    Cancel-Response-Organization-Resource:
      type: object
      properties: 
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          type: object
          properties:
          $ref: "#/components/schemas/Cancel-Response-Organization"
    Cancel-Response-List-Resource:
      type: object
      properties: 
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          type: object
          properties:
          $ref: "#/components/schemas/Create-List"
    Cancel-Response-HealthcareService-Resource:
      type: object
      properties: 
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          type: object
          properties:
          $ref: "#/components/schemas/Cancel-Response-HealthcareService"
    Cancel-Response-CommunicationRequest-Resource:
      type: object
      properties: 
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          type: object
          properties:
          $ref: "#/components/schemas/Create-CommunicationRequest"
    Cancel-Response-Location-Resource:
      type: object
      properties: 
        fullUrl:
          type: string
          description: object URL for the resource
          example: "urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6"
        resource:
          type: object
          properties:
          $ref: "#/components/schemas/Create-Location"
    
    Create-MedicationRequest:
      type: object
      description: A MedicationRequest object is equivalent to a line item on a prescription. An EPS prescription can only contain up to four MedicationRequest objects.
      properties:
        resourceType:
          type: string
          description: FHIR resource type
          default: "MedicationRequest"
        extension:
          type: array
          description: a FHIR extension array.
          items:
            anyOf:
            - $ref: "#/components/schemas/extension-medicationRepeatInformation.yaml"
            - $ref: "#/components/schemas/extension-NHSBSAPrescriptionType.yaml"
            - $ref: "#/components/schemas/extension-prescriptionEndorsement.yaml"
            - $ref: "#/components/schemas/extension-DM-ResponsiblePractitioner.yaml"
            - $ref: "#/components/schemas/extension-controlledDrug.yaml"
        identifier: 
          type: array
          description: The unique ID for each line item on a prescription.
          items:
            type: object
            properties:
              system:
                type: string
                description: codesystem URL for the line item ID.
                enum:
                  - https://fhir.nhs.uk/Id/prescription-order-item-number
              value:
                type: string
                description: the unique ID for a given line item.
                example: dd11b07e-e137-488e-bc28-ab50384208b5
        status:
          type: string
          description: |
            The status of a MedicationRequest object. 
            
            This must be consistent across all MedicationRequests in a Bundle.
          enum:
            - active
        intent:
          type: string
          description: |
            The intent of a MedicationRequest object. 
            
            This must be consistent across all MedicationRequests in a Bundle.
          default: order
        category:
          type: array
          description: |
            Identifies the context in which a prescription is created.
      
            For example, a prescription created within primary care will be categorised as "community."
      
            Similarly, a prescription created within secondary care will be categorised as "inpatient" or "outpatient."
      
            This must be consistent across all MedicationRequests in a Bundle.
          items:
            type: object
            properties:
              coding:
                type: array
                items:
                  type: object
                  properties:
                    system:
                      type: string
                      description: codesystem URL for the prescription category.
                      enum:
                        - http://terminology.hl7.org/CodeSystem/medicationrequest-category
                    code:
                      type: string
                      description: code for the prescription category.
                      enum:
                        - inpatient
                        - outpatient
                        - community
                        - discharge
                    display:
                      type: string
                      description: display value for the prescription category.
                      enum:
                        - "Inpatient"
                        - "Outpatient"
                        - "Community"
                        - "Discharge"
        medicationCodeableConcept:
          type: object
          description: |
            The medication that is being prescribed. 
            
            This must be defined using VMP or AMP concepts from the dm+d.
          properties:
            coding:
              type: array
              items:
                type: object
                properties:
                  system:
                    type: string
                    description: SNOMED codesystem URL
                    enum:
                      - http://snomed.info/sct
                  code:
                    type: string
                    description: SNOMED code for the medication, as defined in the DM+D
                    example: "321196004"
                  display:
                    type: string
                    description: a human readable name for the medication.
                    example: Diazepam 2mg tablets
        subject:
          type: object
          description: |
            Reference object to identify the patient a prescription is for. 
            
            A Patient resource within the Bundle must be referenced.
          properties: 
            reference:
              type: string
              description: A reference to a Patient resource within the Bundle
              example: urn:uuid:78d3c2eb-009e-4ec8-a358-b042954aa9b2
        authoredOn:
          type: string
          description: The time at which the prescription was authored and signed. 
          example: "2021-05-07T14:47:29+00:00"
        requester:
          type: object
          description: |
            Reference object to identify the author of a prescription. 
            
            A PractitionerRole resource within the Bundle must be referenced.
          properties: 
            reference:
              type: string
              description: A reference to a PractitionerRole resource within the Bundle
              example: urn:uuid:56166769-c1c4-4d07-afa8-132b5dfca666
        groupIdentifier:
          type: object
          description: An object containing the short-form and long-form Prescription ID.
          properties:
            system:
              type: string
              description: codesystem URL for the short-form Prescription ID
              enum:
                - "https://fhir.nhs.uk/Id/prescription-order-number"
            value:
              type: string
              description: The short-form Prescription ID
              example: "04F4C2-A99968-7F717P"
            extension:
              type: array
              description: A FHIR extension array containing the long-form Prescription ID.
              items:
                type: object
                properties:
                  url:
                    type: string
                    enum: 
                      - "https://fhir.nhs.uk/StructureDefinition/Extension-DM-PrescriptionId"
                  valueIdentifier:
                    type: object
                    properties:
                      system:
                        type: string
                        description: codesystem URL for the long-form Prescription ID
                        enum:
                          - "https://fhir.nhs.uk/Id/prescription"
                      value:
                        type: string
                        description: The long-form prescription ID
                        example: 613452a2-ca1b-4a76-8191-d92e1f48928c
        courseOfTherapyType:
          type: object
          description: The treatment type of the prescription, i.e. whether it is an acute, repeat, or eRD prescription.
          properties: 
            coding:
              type: array
              items:
                type: object
                properties:
                  system:
                    type: string
                    description: codesystem URL for the prescription treatment type
                    enum:
                      - http://terminology.hl7.org/CodeSystem/medicationrequest-course-of-therap
                  code:
                    type: string
                    description: |
                      code identifying the prescription treatment type.
      
                      * acute: acute prescriptions
                      * continuous: repeat prescriptions
                      * continuous-repeat-dispensing: eRD prescriptions
                    enum:
                      - acute
                      - continuous
                      - continuous-repeat-dispensing
                  display:
                    type: string
                    description: display value for the prescription treatment type
                    enum:
                      - "Short course (acute) therapy"
                      - "Continuous long term therapy"
                      - "Continuous long term (repeat dispensing)"
        dosageInstruction:
          type: array
          description: |
            The dosage instructions for a prescription. 
            
            These must be expressed as both structured dose and text.
          items:
            type: object
            properties: 
              text:
                type: string
                description: The dosage instructions expressed as text
                example: "4 times a day - Oral"
              timing:
                type: object
                description: A structured expression of dose frequency
                properties:
                  repeat:
                    type: object
                    description: the frequency and period over which the medication should be consumed
                    properties:
                      frequency:
                        type: integer
                        description: |
                          The frequency at which the medication should be consumed within a given period.
      
                          E.g. "4" for 4 times over a given period. 
                        example: "4"
                      period:
                        type: integer
                        description: |
                          The period over which the frequency applies.
      
                          e.g. "1" for 1 day.
                      periodUnit:
                        type: string
                        description: | 
                          The fundamental unit of the period, defined in UCUM.
                          
                          e.g. "d" for day.
              route:
                type: object
                description: A structured expression of how the medication should be consumed
                properties:
                  coding:
                    type: array
                    items:
                      type: object
                      properties:
                        system:
                          type: string
                          description: SNOMED codesystem URL
                          enum:
                            - "http://snomed.info/sct"
                        code:
                          type: integer
                          description: valid SNOMED code identifying how the medication should be consumed
                          example: "26643006"
                        display:
                          type: string
                          description: a display value to accompany the SNOMED code
                          example: "Oral"
        note:
          type: array
          description: Specific additional instructions for a prescription line item, e.g. a change in dosage.
          items:
            type: object
            properties: 
              text:
                type: string
                description: Specific additional instructions for a prescription line item
                example: "Dosage has been decreased on advice from the hospital"
        dispenseRequest:
          type: object
          description: |
            A FHIR object containing information relevant to how the prescription should be dispensed. 
            
            These values should be consistent across all MedicationRequests in a Bundle.
          properties: 
            extension:
              type: array
              description: a FHIR extension array.
              items:
                type: object
                properties:
                  url:
                    type: string
                    description: extension URL for DM-PerformerSiteType
                    enum:
                      - "https://fhir.nhs.uk/StructureDefinition/Extension-DM-PerformerSiteType"
                  valueCoding:
                    type: object
                    properties:
                      system:
                        type: string
                        description: codesystem URL to hold the nomination.
                        enum:
                          - "https://fhir.nhs.uk/CodeSystem/dispensing-site-preference"
                      code:
                        type: string
                        description: |
                          The nomination applied to a prescription.
      
                          This could either be a nomination for:
      
                            * A dispensing contractor (P1)
                            * A dispensing appliance contractor (P2)
                            * A dispensing doctor (P3)
      
                          Or a non-nominated prescription (0004).
                        enum:
                          - P1
                          - P2
                          - P3
                          - "0004"
            numberOfRepeatsAllowed:
              type: integer
              description: |
                For eRD and repeat prescriptions only.
                
                The number of repeats a line item is issued for, in addition to the existing issue. E.g. if a prescription is valid for 6 issues in total, the value entered must be 5. 
                
                For repeat prescriptions, this value must always default to 0.
            validityPeriod:
              type: object
              description: |
                The start and end dates of a prescription.
              properties:
                start:
                  type: string
                  description: The start date of a prescription.
                end:
                  type: string
                  description: |
                    For eRD prescriptions only.
      
                    The end date of a prescription. 
            expectedSupplyDuration: 
              type: object
              description: |
                For eRD prescriptions only. 
                
                The duration of each issue within an eRD prescription. This must be expressed in days.
              properties:
                value:
                  type: integer
                  description: the number of days each issue in an eRD prescription is valid for
                  example: 
                unit:
                  type: string
                  description: The UCUM unit of measure display for days.
                  default: "day"
                system:
                  type: string
                  description: Codesystem URL for UCUM 
                  enum:
                    - "http://unitsofmeasure.org"
                code:
                  type: string
                  description: The UCUM unit of measure code for days. 
                  default: "d"
            performer:
              type: object
              description: |
                For nominated prescriptions only, including one-off nominations.
                
                The ODS code of the nominated dispenser.
              properties:
                identifier:
                  type: object
                  properties:
                    system:
                      type: string
                      description: codesystem URL for ODS codes
                      enum:
                        - "https://fhir.nhs.uk/Id/ods-organization-code"
                    value:
                      type: string
                      description: ODS code for the nominated dispenser
                      example: "FCG71"
            quantity:
              type: object
              description: The quantity of the medication being prescribed.
              properties:
                value:
                  type: integer
                  description: the numeric value of the quantity being prescribed
                  example: "60"
                unit:
                  type: string
                  description: the units in which the quantity is prescribed, defined using DM+D units of measure
                  example: "tablet"
                system:
                  type: string
                  description: SNOMED codesystem URL
                  enum:
                    - "http://snomed.info/sct"
                code:
                  type: integer
                  description: The DM+D code associated with a given unit of measure
                  example: "428673006"
        substitution:
          type: object
          description: This is a boolean value that should always default to false because EPS does not support substitutions.
          properties:
            allowedBoolean:
              type: boolean
              enum:
                - "false"
    Create-Patient:
      type: object
      description: The patient the prescription is for.
      additionalProperties: false
      properties:
        resourceType:
          type: string
          description: FHIR resource type.
          default: "Patient"
        identifier:
          type: array
          description: The patient's NHS number.
          items:
            type: object
            properties:
              system:
                  type: string
                  format: url
                  description: codesystem URL for NHS number
                  default: https://fhir.nhs.uk/Id/nhs-number
              value:
                description: The patient's NHS number. The primary identifier of a patient, unique within NHS England and Wales. Always 10 digits and must be a [valid NHS number](https://www.datadictionary.nhs.uk/attributes/nhs_number.html).
                type: string
                pattern: "^\\d{10}$"
                example: "9000000009"
        name:
          type: array
          description: The patient's name. A prescription must only contain a single name and address for the patient.
          items:
            type: object
            properties:
              use:
                type: string
                description: |
                  How this name should be used.
                  * usual - Known as, conventional or the one patient normally uses. A patient always has a usual name.
                  * temp - An alias or temporary name. This may also be used for temporary names assigned at birth or in emergency situations.
                  * nickname - A name that the patient prefers to be addressed by, but is not part of their usual name.
                  * old - This name is no longer in use (or was never correct, but retained for records).
                  * maiden - Name changed for Marriage. A name used prior to changing name because of marriage. This term is not gender specific. The use of this term does not imply any particular history for a person's name.
                  The following use codes are included in the [name-use](https://www.hl7.org/fhir/valueset-name-use.html) value set, but should not be used and is not be returned as part of a retrieval.
                  * official - The formal name as registered in an official (government) registry, but which name might not be commonly used. May be called "legal name".
                  * anonymous - Anonymous assigned name, alias, or pseudonym (used to protect a person's identity for privacy reasons).
                enum: [usual, temp, nickname, old, maiden]
                example: usual
              family:
                type: string
                maxLength: 35
                description: Family name (often called Surname).
                example: Smith
              given:
                type: array
                maxItems: 5
                description: |
                  Given names, including any middle names.
                  Each name(s) should be a separate item in the list. The first given name may include multiple names, separated by a space.
                  Subsequent names must be broken down into list items. For example, the input `[Jane Marie Anne, Jo Adele]` returns `[Jane Marie Anne, Jo, Adele]`.
                example: [Jane Marie Anne, Jo, Adele]
                items:
                  type: string
                  maxLength: 35
                  example: Jane
              prefix:
                type: array
                description: Name prefixes, titles, and prenominals.
                example: [Mrs]
                items:
                  type: string
                  example: Mrs
        gender:
          type: string
          description: |
            Classification of the gender of a patient. The classification is phenotypical rather than genotypical, i.e. it does not provide codes for medical or scientific purposes.
            It is the administrative gender that the patient wishes to be known as. In some cases, this may not be the same as the patient’s registered birth gender, or their current clinical gender.
          enum:
            - male
            - female
            - other
            - unknown
          example: female
        birthDate:
          type: string
          description: |
            The date on which the patient was born or is officially deemed to have been born.
            
            It is a date in the format `yyyy-mm-dd`. Due to data quality issues on a small number of patients `yyyy-mm` and `yyyy` format may also be returned.
            
            When a patient tagged as `very restricted` is retrieved, birth date is removed from the response.
          example: "2010-10-22"
          format: date
        address:
          type: array
          description: The patient's address. A prescription must only contain a single name and address for the patient. 
          items:
            type: object
            properties:
              use:
                type: string
                description: |
                  Purpose of this address:
                    * `home` - the home address is the patient's normal residence. Home address is also known as usual, main, registered, current or permanent address
                    * `temp` - a temporary address is an address used for a set period of time, but where the patient's home, permanent address remains unchanged
                    * `billing` - an address used for correspondence purposes only
                    * `work` - an office address. This can be returned due to legacy data but cannot be added or replaced on update
      
                    A patient should have no more than one current `temp` and/or `billing` address.
                    However, historically this was constrained only by the integration requirements and was not enforced so theoretically more than one can exist for a patient when retrieving.
                    Where multiple instances already exist for the patient it is not expected that local systems should manage those, but should choose the most appropriate one to maintain (e.g. by examining period dates).
      
                    A `home` address is the patient's main residential address and should normally be used for all clinical and demographic purposes, including clinical and appointment correspondence.
                    However additionally, `temp` and `billing` addresses may be provided by a patient when there is a requirement to record an alternative location for the purposes of unbroken care.
                    When sending correspondence to a patient:
                    *  a present and valid `billing` address may take precedence over `home` and `temp` addresses. A patient should have only a single current `billing` address. An address is considered 'valid' according to its period start and end dates.
                    *  if no current `billing` address is provided, a `temp` address may take precedence over the `home` address, again if it is valid according to its period start and end dates.
                    * if there is no valid, current `billing` and/or `temp` address, the `home` address must be used.
                enum: [home, work, temp, billing]
                example: home
              line:
                type: array
                description: |
                  All lines of the address except the postal code.
      
                  Systems must apply the following formatting convention when adding or replacing addresses lines:
                  *  line 1 - premises ID and/or house name, e.g. `Flat 1` or `The Old Schoolhouse`
                  *  line 2 - house number, dependent thoroughfare name and descriptor (if present), thoroughfare name and descriptor, e.g. `23 Mill Lane`
                  *  line 3 - dependent locality/village, locality (if present), e.g. `Boxgrove`
                  *  line 4 - post town, e.g. `Leeds`
                  *  line 5 - county (if present), e.g. `West Yorkshire`
      
                  If any of the lines are blank, they are not returned due to FHIR conformance constraints.
                maxItems: 5
                items:
                  type: string
                example:
                  - 1 Trevelyan Square
                  - Boar Lane
                  - City Centre
                  - Leeds
                  - West Yorkshire
              postalCode:
                type: string
                description: Postal code of the address.
                example: LS1 6AE
        telecom:
          type: array
          description: The patient's telephone number.
          items:
            type: object
            properties:
              system:
                description: Means of communication, such as phone or email.
                type: string
                enum: [phone, fax, email, other]
              use:
                type: string
                description: Location associated with communication system.
                enum: [home, work, temp, mobile]
                example: home
              value:
                description: Phone number, email address, or other identifier for use with contact system.
                type: string
                example: '01632960587'
        generalPractitioner:
          type: array
          description: General practice (not practitioner) with which the patient is or was registered. 
          items:
            type: object
            properties:
              identifier:
                description: Identifier and system of identification used for this Organisation.
                type: object
                properties:
                  system:
                    description: codesystem URL for ODS codes
                    type: string
                    example: 'https://fhir.nhs.uk/Id/ods-organization-code'
                  value:
                    description: Organisation code for the registered general practice, as held in the [Organisation Data Service](https://developer.nhs.uk/apis/ods/).
                    type: string
                    pattern: ^[0-9A-Z]+$
                    example: Y12345
    Create-PractitionerRole:
      type: object
      description: Role-specific details of the author or responsible party of a prescription. 
      properties:
        resourceType:
          type: string
          description: FHIR resource type.
          default: "PractitionerRole"
        identifier:
          type: array
          description: An array containing role-specific identifiers for the prescriber
          items:
            type: object
            properties:
              SDS Role Profile ID:
                type: object
                description: The prescriber's SDS Role Profile ID
                properties:
                  system:
                    type: string
                    description: codesystem URL for the SDS role profile ID
                    enum:
                      - https://fhir.nhs.uk/Id/sds-role-profile-id
                  value:
                    type: string
                    description: SDS role profile ID
                    example: "200102238988"
              NHS BSA Spurious Code:
                type: object
                description: The prescriber's spurious code
                properties:
                  system:
                    type: string
                    description: codesystem URL for the spurious code
                    enum:
                      - https://fhir.hl7.org.uk/Id/nhsbsa-spurious-code
                  value:
                    type: string
                    description: Spurious code
                    example: "677677"
        practitioner:
          type: object
          description: a reference to a Practitioner resource for a given prescriber.
          properties:
            reference:
              type: string
              description: a FHIR reference object
              example: urn:uuid:a8c85454-f8cb-498d-9629-78e2cb5fa38b
        organization:
          type: object
          description: | 
            a reference to an Organization resource.
      
            Where the prescription is a primary care prescription, this will be a reference to the prescribing organisation.
            
            Where the prescription is a secondary care prescription, this will be a reference to the managing organisation.
          properties:
            reference:
              type: string
              description: a FHIR reference object
              example: urn:uuid:a8c85454-f8cb-498d-9629-78e2cb5fa38b
        code:
          type: array
          description: The SDS job role code for a given prescriber.
          items:
            type: object
            properties:
              coding:
                type: array
                items:
                  type: object
                  properties:
                    system:
                      type: string
                      description: codesystem URL for the job role code
                      enum:
                        - https://fhir.hl7.org.uk/CodeSystem/UKCore-SDSJobRoleName
                    code:
                      type: string
                      description: the SDS job role code
                      example: R8000
                    display:
                      type: string
                      description: human-readable name of the job role for a given job role code
                      example: Clinical Practitioner Access 
        healthcareService:
          type: array
          description: |
            A reference to a healthcareService resource. 
      
            Where a secondary care prescription is being created, this will be a reference to the prescribing organisation.
          items:
            type: object
            properties:
              reference:
                type: string
                description: a reference to a healthcareService resource within the Bundle.
                example: "urn:uuid:54b0506d-49af-4245-9d40-d7d64902055e"
              display:
                type: string
                description: the name of the prescribing organisation.
                example: "SEVERN FIELDS MEDICAL PRACTICE"
        telecom:
          type: array
          description: the telephone number of a given prescriber.
          items:
            type: object
            properties:
              system:
                description: Means of communication, such as phone or email.
                type: string
                enum: [phone, fax, email, other]
                default: phone
              use:
                type: string
                description: Location associated with the contact details provided.
                enum: [home, work, temp, mobile]
                default: work
              value:
                description: Phone number, email address, or other identifier for use with contact system.
                type: string
                example: '01234567890'
    Create-Practitioner:
      type: object
      description: Details of the author or responsible party of a prescription. 
      properties:
        resourceType:
          type: string
          description: FHIR resource type.
          default: "Practitioner"
        identifier:
          type: array
          description: An array containing the prescriber's professional codes and identifiers.
          items:
            type: object
            properties:
              SDS User Identifier:
                type: object
                description: The prescriber's SDS User Identifier
                properties:
                  system:
                    type: string
                    description: codesystem URL for the SDS User Identifier
                    enum:
                      - https://fhir.nhs.uk/Id/sds-user-id
                  value:
                    type: string
                    description: SDS User Identifier
                    example: "555086689107"
              DIN number:
                type: object
                description: The prescriber's DIN number
                properties:
                  system:
                    type: string
                    description: codesystem URL for the DIN number
                    enum:
                      - https://fhir.hl7.org.uk/Id/din-number
                  value:
                    type: string
                    description: DIN number
                    example: "977677"
              GMC number:
                type: object
                description: The prescriber's GMC number
                properties:
                  system:
                    type: string
                    description: codesystem URL for the GMC number
                    enum:
                      - https://fhir.hl7.org.uk/Id/gmc-number
                  value:
                    type: string
                    description: GMC number
                    example: "6095103"
              GPhC number:
                type: object
                description: The prescriber's GPhC number
                properties:
                  system:
                    type: string
                    description: codesystem URL for the GPhC number
                    enum:
                      - https://fhir.hl7.org.uk/Id/gphc-number
                  value:
                    type: string
                    description: GPhC number
                    example: "2095103"
              HCPC number:
                type: object
                description: The prescriber's HCPC number
                properties:
                  system:
                    type: string
                    description: codesystem URL for the HCPC number
                    enum:
                      - https://fhir.hl7.org.uk/Id/hcpc-number
                  value:
                    type: string
                    description: HCPC number
                    example: "CH001234"
              NMC code:
                type: object
                description: The prescriber's NMC code
                properties:
                  system:
                    type: string
                    description: codesystem URL for the NMC code
                    enum:
                      - https://fhir.hl7.org.uk/Id/nmc-number
                  value:
                    type: string
                    description: NMC code
                    example: "71A2998E"
        name:
          type: array
          description: The prescriber's name.
          items:
            type: object
            properties:
              family:
                type: string
                description: Family name (often called Surname).
                example: Smith
              given:
                type: array
                description: Given names, including any middle names.
                items:
                  type: string
              prefix:
                type: array
                description: Name prefixes, titles, and prenominals.
                items:
                  type: string
                  example: Mrs
    Create-Organization:
      type: object
      description: Details of prescribing organisation (primary care) or the managing organisation (secondary care) for a prescription.
      properties:
        resourceType:
          type: string
          description: FHIR resource type.
          default: "Organization"
        identifier:
          type: array
          description: An array containing the ODS code of the organisation
          items:
            type: object
            properties:
              system:
                type: string
                description: codesystem URL for the ODS code
                enum:
                  - https://fhir.nhs.uk/Id/ods-organization-code
              value:
                type: string
                description: ODS code
                example: "A83008"
        name:
          type: string
          description: Organisation name.
        address:
          type: array
          description: Organisation address.
          items:
            type: object
            properties:
              use:
                type: string
                description: The purpose of the address. 
                default: work
                enum:
                  - home
                  - work
                  - billing
                  - temp
              type:
                type: string
                description: The type of address.
                default: both
                enum:
                  - postal
                  - physical
                  - both
              line:
                type: array
                description: |
                  All lines of the address except the city, district, and postal code.
      
                  Systems must apply the following formatting convention when adding or replacing addresses lines:
                  *  line 1 - premises ID and/or house name, e.g. `Flat 1` or `The Old Schoolhouse`
                  *  line 2 - house number, dependent thoroughfare name and descriptor (if present), thoroughfare name and descriptor, e.g. `23 Mill Lane`
                  *  line 3 - dependent locality/village, locality (if present), e.g. `Boxgrove`
      
                  If any of the lines are blank, they are not returned due to FHIR conformance constraints.
                items:
                  type: string
                example:
                  - 1 Trevelyan Square
                  - Boar Lane
                  - City Centre
              city:
                type: string
                description: The city of the address. 
                example: Leeds
              district:
                type: string
                description: The district of the address. 
                example: West Yorkshire
              postalCode:
                type: string
                description: The postal code of the address.
                example: LS1 6AE
        telecom:
          type: array
          description: The telephone number associated with the organisation.
          items:
            type: object
            properties:
              system:
                description: Means of communication, such as phone or email.
                type: string
                enum: [phone, fax, email, other]
                default: phone
              use:
                type: string
                description: Location associated with the contact details provided.
                enum: [home, work, temp, mobile]
                default: work
              value:
                description: Phone number, email address, or other identifier for use with contact system.
                type: string
                example: '01234567890'
        partOf:
          type: object
          description: For a primary care prescription, the managing organisation that the prescribing organisation is a part of.
          properties:
            identifier:
              type: object
              description: the ODS code for the managing organisation.
              properties:
                system:
                  type: string
                  description: codesystem URL for the ODS code
                  enum:
                    - "https://fhir.nhs.uk/Id/ods-organization-code"
                value:
                  type: string
                  description: ODS code
                  example: "84H"
            display:
              type: string
              description: the name of the managing organisation
              example: "NHS County Durham CCG"
    Create-HealthcareService:
      type: object
      description: |
        For secondary care prescriptions only.
        
        Where the prescription is a secondary care prescription, the healthcareService resource will contain details of the prescribing organisation.
      properties:
        resourceType:
          type: string
          description: FHIR resource type.
          default: "healthcareService"
        identifier:
          type: array
          description: An array containing the ODS code of the organisation
          items:  
            type: object
            properties:
              object:
                type: object
                properties:
                  system:
                    type: string
                    description: codesystem URL for the ODS code
                    enum:
                      - https://fhir.nhs.uk/Id/ods-organization-code
                  value:
                    type: string
                    description: ODS code
                    example: "A83008"
        providedBy:
          type: object
          description: The managing organisation that the prescribing organisation is a part of.
          properties:
            identifier:
              type: object
              properties:
                system:
                  type: string
                  description: codesystem URL 
                  enum:
                    - "https://fhir.nhs.uk/Id/ods-organization-code"
                value:
                  type: string
                  description: ODS code for the managing organisation
                  example: "RRE"
        location:
          type: array
          description: |
            A reference to a Location resource.
      
            Where the prescription is a secondary care prescription, the location resource will contain the address of the prescribing organisation.
          items:
            type: object
            properties:
              object: 
                type: object
                properties:
                  reference:
                    type: string
                    description: a reference to a Location resource
        name:
          type: string
          description: Organisation name.
        telecom:
          type: array
          description: The telephone number associated with the organisation.
          items:
            type: object
            properties:
              system:
                description: Means of communication, such as phone or email.
                type: string
                enum: [phone, fax, email, other]
                default: phone
              use:
                type: string
                description: Location associated with the contact details provided.
                enum: [home, work, temp, mobile]
                default: work
              value:
                description: Phone number, email address, or other identifier for use with contact system.
                type: string
                example: '01234567890'
    Create-MessageHeader:
      type: object
      properties:
        resourceType:
          type: string
          description: FHIR resource type.
          default: "MessageHeader"
        eventCoding:
          type: object
          description: The type of message event being generated.
          properties:
            system:
              type: string
              description: codesystem URL for message events.
              enum:
                - "https://fhir.nhs.uk/CodeSystem/message-event"
            code:
              type: string
              description: code for the message event.
              enum:
                - "prescription-order"
            display:
              type: string
              description: display value accompanying the code for the message event.
              enum:
                - "Prescription Order"
        source:
          type: object
          description: The organisation originating the message. 
          properties:
            endpoint:
              type: string
              description: ODS code of the organisation originating the message, expressed as a URN. 
              example: "urn:nhs-uk:addressing:ods:A83008"
    Create-List:
      type: object
      description: |
        For repeat and eRD prescriptions only. 
      
        A structured list of repeat medication items prescribed to the patient.
      properties:
        resourceType:
          type: string
          description: FHIR resource type.
          default: "List"
        status:
          type: string
          description: The status of the List object. Must always default to "current".
          enum:
            - "current"
        mode:
          type: string
          description: The type of List being represented. Must always default to "snapshot".
          enum:
            - "snapshot"
        code:
          type: object
          description: A description of what the list represents. 
          properties:
            text:
              type: string
              description: A description of what the list represents. Must always default to "Repeat Medications."
              enum:
                - "Repeat Medications"
        subject:
          type: object
          description: A reference object to identify the patient the prescription is for.
          properties:
            reference:
              type: string
              description: A reference to a Patient resource within the Bundle. 
              example: "urn:uuid:78d3c2eb-009e-4ec8-a358-b042954aa9b2"
        entry:
          type: array
          description: list of repeat medication items prescribed to the patient. 
          items:
            type: object
            description: FHIR wrapper object to contain the medication item.
            properties:
              item: 
                type: object
                description: A medication item, defined using its DM+D name and description.
                example: "Bendroflumethiazide 2.5mg tablets (3/6)"
    Create-CommunicationRequest:
      type: object
      description: |
        Additional instructions intended for the patient.
      
        For repeat prescriptions, a reference must also be provided to the list of repeat medications that the patient is on. 
      properties:
        resourceType:
          type: string
          description: FHIR resource type.
          default: "CommunicationRequest"
        status:
          type: string
          description: The status of the CommunicationRequest. Must always default to "active".
          enum:
            - "active"
        subject:
          type: object
          description: A reference object to identify the patient the prescription is for.
          properties:
            reference:
              type: string
              description: A reference to a Patient resource within the Bundle. 
              example: "urn:uuid:78d3c2eb-009e-4ec8-a358-b042954aa9b2"
        payload:
          type: array
          description: Additional instructions provided as part of this prescription. 
          items:
            type: object
            properties:
              contentString:
                type: string
                description: Additional instructions intended for the patient.
                example: "Please make an appointment to see your GP"
              contentReference:
                type: object
                description: A reference to the list of repeat medications that the patient is on.
                properties: 
                  reference:
                    type: string
                    description: A reference to a List resource within the Bundle
        requester:
          type: object
          description: Details of the prescribing organisation originating the instructions.
          properties:
            identifier:
              type: object
              properties:
                system:
                  type: string
                  description: codesystem URL for ODS codes
                  enum:
                    - "https://fhir.nhs.uk/Id/ods-organization-code"
                value:
                  type: string
                  description: ODS code for the prescribing organisation
                  example: "FCG71"
        recipient:
          type: array
          description: Details of the patient receiving the instructions. 
          items:
            type: object
            properties:
              identifier:
                type: object
                properties:
                  system:
                      type: string
                      format: url
                      description: FHIR codesystem URL for NHS numbers.
                      default: https://fhir.nhs.uk/Id/nhs-number
                  value:
                    description: The patient's NHS number. The primary identifier of a patient, unique within NHS England and Wales. Always 10 digits and must be a [valid NHS number](https://www.datadictionary.nhs.uk/attributes/nhs_number.html).
                    type: string
                    pattern: "^\\d{10}$"
                    example: "9000000009"
    Create-Location:
      type: object
      description: |
        For secondary care prescriptions only.
        
        Where the prescription is a secondary care prescription, the Location resource will contain the address of the prescribing organisation.
      properties:
        resourceType:
          type: string
          description: FHIR resource type.
          default: "Location"
        address:
          type: array
          description: Organisation address.
          items:
            type: object
            properties:
              line:
                type: array
                description: |
                  All lines of the address except the postal code.
        
                    Systems must apply the following formatting convention when adding or replacing addresses lines:
                    *  line 1 - premises ID and/or house name, e.g. `Flat 1` or `The Old Schoolhouse`
                    *  line 2 - house number, dependent thoroughfare name and descriptor (if present), thoroughfare name and descriptor, e.g. `23 Mill Lane`
                    *  line 3 - dependent locality/village, locality (if present), e.g. `Boxgrove`
                    *  line 4 - post town, e.g. `Leeds`
                    *  line 5 - county (if present), e.g. `West Yorkshire`
        
                  If any of the lines are blank, they are not returned due to FHIR conformance constraints.
                items:
                  type: string
                example:
                  - 1 Trevelyan Square
                  - Boar Lane
                  - City Centre
                  - Leeds
                  - West Yorkshire
              postalCode:
                type: string
                description: Postal code of the address.
                example: LS1 6AE
    Create-Provenance:
      type: object
      description: A resource to contain the digital signature attached to a prescription.
      properties:
        resourceType:
          type: string
          description: FHIR resource type.
          default: "Provenance"
        target:
          type: array
          description: | 
            Reference object to identify the line items in a prescription that are being signed.
      
            A reference to each MedicationRequest resource in the Bundle must be provided.
          items:
            type: object
            properties:
              reference:
                type: string
                description: A reference to a MedicationRequest resource in a Bundle.
                example: urn:uuid:a54219b8-f741-4c47-b662-e4f8dfa49ab6
        recorded:
          type: string
          description: The time the prescription was signed.
        agent:
          type: array
          description: | 
            A reference to the prescriber who signed the prescription, i.e. the author of the prescription.
      
            A PractitionerRole resource within the Bundle must be referenced. 
          items:
            type: object
            properties:
              who:
                type: object
                properties:
                  reference:
                    type: string
                    description: A reference to a PractitionerRole resource within the Bundle.
                    example: "urn:uuid:56166769-c1c4-4d07-afa8-132b5dfca666"
        signature:
          type: array
          description: The Advanced Electronic Signature (AES) attached to a prescription. 
          items:
            type: object
            properties:
              type:
                type: array
                description: The type of signature attached to a prescription.
                items:
                  type: object
                  properties:
                    system:
                      type: string
                      description: FHIR codesystem URN for signatures
                      enum:
                        - "urn:iso-astm:E1762-95:2013"
                    code:
                      type: string
                      enum:
                        - "1.2.840.10065.1.12.1.1"
              when:
                type: string
                description: The time the prescription was signed.
                example: "2022-08-21T17:02:39+00:00"
              who:
                type: object
                properties:
                  reference:
                    type: string
                    description: |
                      A reference to a PractitionerRole resource within the Bundle. 
                  
                      This will still be a reference to the prescriber who signed the prescription.
                    example: "urn:uuid:56166769-c1c4-4d07-afa8-132b5dfca666"
              data:
                type: string
                description: An advanced electronic signature, which may be generated using the Signing Service.
    
    Cancel-Request-MessageHeader:
      type: object
      properties:
        resourceType:
          type: string
          description: FHIR resource type.
          default: "MessageHeader"
        eventCoding:
          type: object
          description: The type of message event being generated.
          properties:
            system:
              type: string
              description: codesystem URL for message events.
              enum:
                - "https://fhir.nhs.uk/CodeSystem/message-event"
            code:
              type: string
              description: code for the message event.
              enum:
                - "prescription-order-update"
            display:
              type: string
              description: display value accompanying the code for the message event.
              enum:
                - "Prescription Order Update"
        source:
          type: object
          description: The organisation originating the message. 
          properties:
            endpoint:
              type: string
              description: ODS code of the organisation originating the message, expressed as a URN. 
              example: "urn:nhs-uk:addressing:ods:A83008"
    Cancel-Request-MedicationRequest:
      type: object
      description: A cancel request is effectively an update to a prescription, expressed through a MedicationRequest resource for each line item that is being cancelled.
      properties:
        resourceType:
          type: string
          description: FHIR resource type
          default: "MedicationRequest"
        statusReason:
          type: object
          description: |
            The reason the line item is being cancelled.
    
            The reason must be in line with the cancellation reasons vocabulary <link>.
          properties:
            coding:
              type: array
              items:
                type: object
                properties:
                  system:
                    type: string
                    description: codesystem URL for the cancellation reason.
                    enum:
                      - "https://fhir.nhs.uk/CodeSystem/medicationrequest-status-reason"
                  code:
                    type: string
                    description: cancel reason code.
                    example: "0004"
                    enum:
                      - "0001"
                      - "0002"
                      - "0003"
                      - "0004"
                      - "0005"
                      - "0006"
                      - "0007"
                      - "0008"
                      - "0009"
                  display:
                    type: string
                    description: the display accompanying the cancel reason code.
                    example: "Clinical grounds"
                    enum:
                      - "Prescribing error"
                      - "Clinical contra-indication"
                      - "Change to medication treatment regime"
                      - "Clinical grounds"
                      - "At the Patient's request"
                      - "At the Pharmacist's request"
                      - "Notification of Death"
                      - "Patient deducted - other reason"
                      - "Patient deducted- registered with new practice"
        extension:
          type: array
          description: a FHIR extension array.
          items:
            anyOf:
            - $ref: "#/components/schemas/extension-DM-ResponsiblePractitioner.yaml"
        identifier: 
          type: array
          description: The unique ID for each line item on a prescription.
          items:
            type: object
            properties:
              system:
                type: string
                description: codesystem URL for the line item ID.
                enum:
                  - https://fhir.nhs.uk/Id/prescription-order-item-number
              value:
                type: string
                description: the unique ID for a given line item.
                example: dd11b07e-e137-488e-bc28-ab50384208b5
        status:
          type: string
          description: |
            The status of a MedicationRequest object. 
            
            This must be consistent across all MedicationRequests in a Bundle.
          enum:
            - cancelled
        intent:
          type: string
          description: |
            The intent of a MedicationRequest object. 
            
            This must be consistent across all MedicationRequests in a Bundle.
          default: order
        category:
          type: array
          description: |
            Identifies the context in which a prescription is created.
    
            For example, a prescription created within primary care will be categorised as "community."
    
            Similarly, a prescription created within secondary care will be categorised as "inpatient" or "outpatient."
          items:
            type: object
            properties:
              coding:
                type: array
                items:
                  type: object
                  properties:
                    system:
                      type: string
                      description: codesystem URL for the prescription category.
                      enum:
                        - http://terminology.hl7.org/CodeSystem/medicationrequest-category
                    code:
                      type: string
                      description: code for the prescription category.
                      enum:
                        - inpatient
                        - outpatient
                        - community
                        - discharge
                    display:
                      type: string
                      description: display value for the prescription category.
                      enum:
                        - "Inpatient"
                        - "Outpatient"
                        - "Community"
                        - "Discharge"
        medicationCodeableConcept:
          type: object
          description: |
            The medication that is being cancelled. 
            
            This must be defined using VMP or AMP concepts from the dm+d.
          properties:
            coding:
              type: array
              items:
                type: object
                properties:
                  system:
                    type: string
                    description: SNOMED codesystem URL
                    enum:
                      - http://snomed.info/sct
                  code:
                    type: string
                    description: SNOMED code for the medication, as defined in the DM+D
                    example: "321196004"
                  display:
                    type: string
                    description: a human readable name for the medication.
                    example: Diazepam 2mg tablets
        subject:
          type: object
          description: |
            Reference object to identify the patient a prescription is for. 
            
            A Patient resource within the Bundle must be referenced.
          properties: 
            reference:
              type: string
              description: A reference to a Patient resource within the Bundle
              example: urn:uuid:78d3c2eb-009e-4ec8-a358-b042954aa9b2
        authoredOn:
          type: string
          description: The time at which the prescription was authored and signed. 
          example: "2021-05-07T14:47:29+00:00"
        requester:
          type: object
          description: |
            Reference object to identify the author of a cancel request. 
            
            A PractitionerRole resource within the Bundle must be referenced.
          properties: 
            reference:
              type: string
              description: A reference to a PractitionerRole resource within the Bundle
              example: urn:uuid:56166769-c1c4-4d07-afa8-132b5dfca666
        groupIdentifier:
          type: object
          description: An object containing the short-form and long-form Prescription ID.
          properties:
            system:
              type: string
              description: codesystem URL for the short-form Prescription ID
              enum:
                - "https://fhir.nhs.uk/Id/prescription-order-number"
            value:
              type: string
              description: The short-form Prescription ID
              example: "04F4C2-A99968-7F717P"
            extension:
              type: array
              description: A FHIR extension array containing the long-form Prescription ID.
              items:
                type: object
                properties:
                  url:
                    type: string
                    enum: 
                      - "https://fhir.nhs.uk/StructureDefinition/Extension-DM-PrescriptionId"
                  valueIdentifier:
                    type: object
                    properties:
                      system:
                        type: string
                        description: codesystem URL for the long-form Prescription ID
                        enum:
                          - "https://fhir.nhs.uk/Id/prescription"
                      value:
                        type: string
                        description: The long-form prescription ID
                        example: 613452a2-ca1b-4a76-8191-d92e1f48928c
        courseOfTherapyType:
          type: object
          description: The treatment type of the prescription, i.e. whether it is an acute, repeat, or eRD prescription.
          properties: 
            coding:
              type: array
              items: 
                type: object
                properties:
                  system:
                    type: string
                    description: codesystem URL for the prescription treatment type
                    enum:
                      - http://terminology.hl7.org/CodeSystem/medicationrequest-course-of-therap
                  code:
                    type: string
                    description: |
                      code identifying the prescription treatment type.
    
                      * acute: acute prescriptions
                      * continuous: repeat prescriptions
                      * continuous-repeat-dispensing: eRD prescriptions
                    enum:
                      - acute
                      - continuous
                      - continuous-repeat-dispensing
                  display:
                    type: string
                    description: display value for the prescription treatment type
                    enum:
                      - "Short course (acute) therapy"
                      - "Continuous long term therapy"
                      - "Continuous long term (repeat dispensing)"
        dosageInstruction:
          type: array
          description: |
            The dosage instructions for a prescription. 
            
            These must be expressed as both structured dose and text.
          items:
            type: object
            properties: 
              text:
                type: string
                description: The dosage instructions expressed as text
                example: "4 times a day - Oral"
              timing:
                type: object
                description: A structured expression of dose frequency
                properties:
                  repeat:
                    type: object
                    description: the frequency and period over which the medication should be consumed
                    properties:
                      frequency:
                        type: integer
                        description: |
                          The frequency at which the medication should be consumed within a given period.
    
                          E.g. "4" for 4 times over a given period. 
                        example: "4"
                      period:
                        type: integer
                        description: |
                          The period over which the frequency applies.
    
                          e.g. "1" for 1 day.
                      periodUnit:
                        type: string
                        description: | 
                          The fundamental unit of the period, defined in UCUM.
                          
                          e.g. "d" for day.
              route:
                type: object
                description: A structured expression of how the medication should be consumed
                properties:
                  coding:
                    type: array
                    items:
                      type: object
                      properties:
                        system:
                          type: string
                          description: SNOMED codesystem URL
                          enum:
                            - "http://snomed.info/sct"
                        code:
                          type: integer
                          description: valid SNOMED code identifying how the medication should be consumed
                          example: "26643006"
                        display:
                          type: string
                          description: a display value to accompany the SNOMED code
                          example: "Oral"
        note:
          type: array
          description: Specific additional instructions for a prescription line item, e.g. a change in dosage.
          items:
            type: object
            properties: 
              text:
                type: string
                description: Specific additional instructions for a prescription line item
                example: "Dosage has been decreased on advice from the hospital"
        dispenseRequest:
          type: object
          description: |
            A FHIR object containing information relevant to how the prescription should be dispensed. 
            
            These values should be consistent across all MedicationRequests in a Bundle.
          properties: 
            extension:
              type: array
              description: a FHIR extension array.
              items:
                type: object
                properties:
                  url:
                    type: string
                    description: extension URL for DM-PerformerSiteType
                    enum:
                      - "https://fhir.nhs.uk/StructureDefinition/Extension-DM-PerformerSiteType"
                  valueCoding:
                    type: object
                    properties:
                      system:
                        type: string
                        description: extension URL to hold the nomination.
                        enum:
                          - "https://fhir.nhs.uk/CodeSystem/dispensing-site-preference" 
                      code:
                        type: string
                        description: |
                          The nomination applied to a prescription.
    
                          This could either be a nomination for:
    
                            * A dispensing contractor (P1)
                            * A dispensing appliance contractor (P2)
                            * A dispensing doctor (P3)
    
                          Or a non-nominated prescription (0004).
    
                        enum:
                          - P1
                          - P2
                          - P3
                          - "0004"
            numberOfRepeatsAllowed:
              type: integer
              description: |
                For eRD and repeat prescriptions only.
                
                The number of repeats a line item is issued for, in addition to the existing issue. E.g. if a prescription is valid for 6 issues in total, the value entered must be 5. 
                
                For repeat prescriptions, this value must always default to 0.
            validityPeriod:
              type: object
              description: |
                The start and end dates of a prescription.
              properties:
                start:
                  type: string
                  description: The start date of a prescription.
                end:
                  type: string
                  description: |
                    For eRD prescriptions only.
    
                    The end date of a prescription. 
            expectedSupplyDuration: 
              type: object
              description: |
                For eRD prescriptions only. 
                
                The duration of each issue within an eRD prescription. This must be expressed in days.
              properties:
                value:
                  type: integer
                  description: the number of days each issue in an eRD prescription is valid for
                  example: 
                unit:
                  type: string
                  description: The UCUM unit of measure display for days.
                  default: "day"
                system:
                  type: string
                  description: Codesystem URL for UCUM 
                  enum:
                    - "http://unitsofmeasure.org"
                code:
                  type: string
                  description: The UCUM unit of measure code for days. 
                  default: "d"
            performer:
              type: object
              description: |
                For nominated prescriptions only, including one-off nominations.
                
                The ODS code of the nominated dispenser.
              properties:
                identifier:
                  type: object
                  properties:
                    system:
                      type: string
                      description: codesystem URL for ODS codes
                      enum:
                        - "https://fhir.nhs.uk/Id/ods-organization-code"
                    value:
                      type: string
                      description: ODS code for the nominated dispenser
                      example: "FCG71"
            quantity:
              type: object
              description: The quantity of the medication being prescribed.
              properties:
                value:
                  type: integer
                  description: the numeric value of the quantity being prescribed
                  example: "60"
                unit:
                  type: string
                  description: the units in which the quantity is prescribed, defined using DM+D units of measure
                  example: "tablet"
                system:
                  type: string
                  description: SNOMED codesystem URL
                  enum:
                    - "http://snomed.info/sct"
                code:
                  type: integer
                  description: The DM+D code associated with a given unit of measure
                  example: "428673006"
        substitution:
          type: object
          description: This is a boolean value that should always default to false because EPS does not support substitutions.
          properties:
            allowedBoolean:
              type: boolean
              enum:
                - "false"
    Cancel-Request-Patient:
      type: object
      description: The patient the prescription is for.
      additionalProperties: false
      properties:
        resourceType:
          type: string
          description: FHIR resource type.
          default: "Patient"
        identifier:
          type: array
          description: The patient's NHS number.
          items:
            type: object
            properties:
              system:
                  type: string
                  format: url
                  description: codesystem URL for NHS number
                  default: https://fhir.nhs.uk/Id/nhs-number
              value:
                description: The patient's NHS number. The primary identifier of a patient, unique within NHS England and Wales. Always 10 digits and must be a [valid NHS number](https://www.datadictionary.nhs.uk/attributes/nhs_number.html).
                type: string
                pattern: "^\\d{10}$"
                example: "9000000009"
        name:
          type: array
          description: The patient's name. A prescription must only contain a single name and address for the patient.
          items:
            type: object
            properties:
              use:
                type: string
                description: |
                  How this name should be used.
                  * usual - Known as, conventional or the one patient normally uses. A patient always has a usual name.
                  * temp - An alias or temporary name. This may also be used for temporary names assigned at birth or in emergency situations.
                  * nickname - A name that the patient prefers to be addressed by, but is not part of their usual name.
                  * old - This name is no longer in use (or was never correct, but retained for records).
                  * maiden - Name changed for Marriage. A name used prior to changing name because of marriage. This term is not gender specific. The use of this term does not imply any particular history for a person's name.
                  The following use codes are included in the [name-use](https://www.hl7.org/fhir/valueset-name-use.html) value set, but should not be used and is not be returned as part of a retrieval.
                  * official - The formal name as registered in an official (government) registry, but which name might not be commonly used. May be called "legal name".
                  * anonymous - Anonymous assigned name, alias, or pseudonym (used to protect a person's identity for privacy reasons).
                enum: [usual, temp, nickname, old, maiden]
                example: usual
              family:
                type: string
                maxLength: 35
                description: Family name (often called Surname).
                example: Smith
              given:
                type: array
                maxItems: 5
                description: |
                  Given names, including any middle names.
                  Each name(s) should be a separate item in the list. The first given name may include multiple names, separated by a space.
                  Subsequent names must be broken down into list items. For example, the input `[Jane Marie Anne, Jo Adele]` returns `[Jane Marie Anne, Jo, Adele]`.
                example: [Jane Marie Anne, Jo, Adele]
                items:
                  type: string
                  maxLength: 35
                  example: Jane
              prefix:
                type: array
                description: Name prefixes, titles, and prenominals.
                example: [Mrs]
                items:
                  type: string
                  example: Mrs
        gender:
          type: string
          description: |
            Classification of the gender of a patient. The classification is phenotypical rather than genotypical, i.e. it does not provide codes for medical or scientific purposes.
            It is the administrative gender that the patient wishes to be known as. In some cases, this may not be the same as the patient’s registered birth gender, or their current clinical gender.
          enum:
            - male
            - female
            - other
            - unknown
          example: female
        birthDate:
          type: string
          description: |
            The date on which the patient was born or is officially deemed to have been born.
            
            It is a date in the format `yyyy-mm-dd`. Due to data quality issues on a small number of patients `yyyy-mm` and `yyyy` format may also be returned.
            
            When a patient tagged as `very restricted` is retrieved, birth date is removed from the response.
          example: "2010-10-22"
          format: date
        address:
          type: array
          description: The patient's address. A prescription must only contain a single name and address for the patient. 
          items:
            type: object
            properties:
              use:
                type: string
                description: |
                  Purpose of this address:
                    * `home` - the home address is the patient's normal residence. Home address is also known as usual, main, registered, current or permanent address
                    * `temp` - a temporary address is an address used for a set period of time, but where the patient's home, permanent address remains unchanged
                    * `billing` - an address used for correspondence purposes only
                    * `work` - an office address. This can be returned due to legacy data but cannot be added or replaced on update
      
                    A patient should have no more than one current `temp` and/or `billing` address.
                    However, historically this was constrained only by the integration requirements and was not enforced so theoretically more than one can exist for a patient when retrieving.
                    Where multiple instances already exist for the patient it is not expected that local systems should manage those, but should choose the most appropriate one to maintain (e.g. by examining period dates).
      
                    A `home` address is the patient's main residential address and should normally be used for all clinical and demographic purposes, including clinical and appointment correspondence.
                    However additionally, `temp` and `billing` addresses may be provided by a patient when there is a requirement to record an alternative location for the purposes of unbroken care.
                    When sending correspondence to a patient:
                    *  a present and valid `billing` address may take precedence over `home` and `temp` addresses. A patient should have only a single current `billing` address. An address is considered 'valid' according to its period start and end dates.
                    *  if no current `billing` address is provided, a `temp` address may take precedence over the `home` address, again if it is valid according to its period start and end dates.
                    * if there is no valid, current `billing` and/or `temp` address, the `home` address must be used.
                enum: [home, work, temp, billing]
                example: home
              line:
                type: array
                description: |
                  All lines of the address except the postal code.
      
                  Systems must apply the following formatting convention when adding or replacing addresses lines:
                  *  line 1 - premises ID and/or house name, e.g. `Flat 1` or `The Old Schoolhouse`
                  *  line 2 - house number, dependent thoroughfare name and descriptor (if present), thoroughfare name and descriptor, e.g. `23 Mill Lane`
                  *  line 3 - dependent locality/village, locality (if present), e.g. `Boxgrove`
                  *  line 4 - post town, e.g. `Leeds`
                  *  line 5 - county (if present), e.g. `West Yorkshire`
      
                  If any of the lines are blank, they are not returned due to FHIR conformance constraints.
                maxItems: 5
                items:
                  type: string
                example:
                  - 1 Trevelyan Square
                  - Boar Lane
                  - City Centre
                  - Leeds
                  - West Yorkshire
              postalCode:
                type: string
                description: Postal code of the address.
                example: LS1 6AE
        telecom:
          type: array
          description: The patient's telephone number.
          items:
            type: object
            properties:
              system:
                description: Means of communication, such as phone or email.
                type: string
                enum: [phone, fax, email, other]
              use:
                type: string
                description: Location associated with communication system.
                enum: [home, work, temp, mobile]
                example: home
              value:
                description: Phone number, email address, or other identifier for use with contact system.
                type: string
                example: '01632960587'
        generalPractitioner:
          type: array
          description: General practice (not practitioner) with which the patient is or was registered. 
          items:
            type: object
            properties:
              identifier:
                description: Identifier and system of identification used for this Organisation.
                type: object
                properties:
                  system:
                    description: codesystem URL for ODS codes
                    type: string
                    example: 'https://fhir.nhs.uk/Id/ods-organization-code'
                  value:
                    description: Organisation code for the registered general practice, as held in the [Organisation Data Service](https://developer.nhs.uk/apis/ods/).
                    type: string
                    pattern: ^[0-9A-Z]+$
                    example: Y12345
    Cancel-Request-PractitionerRole:
      type: object
      description: Role-specific details of the author or responsible party of a cancel request.
      properties:
        resourceType:
          type: string
          description: FHIR resource type.
          default: "PractitionerRole"
        identifier:
          type: array
          description: An array containing role-specific identifiers for the prescriber
          items:
            type: object
            properties:
              SDS Role Profile ID:
                type: object
                description: The prescriber's SDS Role Profile ID
                properties:
                  system:
                    type: string
                    description: codesystem URL for the SDS role profile ID
                    enum:
                      - https://fhir.nhs.uk/Id/sds-role-profile-id
                  value:
                    type: string
                    description: SDS role profile ID
                    example: "200102238988"
        practitioner:
          type: object
          description: A reference to a Practitioner resource for a given prescriber.
          properties:
            reference:
              type: string
              description: A FHIR reference object
              example: urn:uuid:a8c85454-f8cb-498d-9629-78e2cb5fa38b
        organization:
          type: object
          description: | 
            A reference to an Organization resource.
      
            Where the prescription is a primary care prescription, this will be a reference to the prescribing organisation.
            
            Where the prescription is a secondary care prescription, this will be a reference to the managing organisation.
          properties:
            reference:
              type: string
              description: a FHIR reference object
              example: urn:uuid:a8c85454-f8cb-498d-9629-78e2cb5fa38b
        code:
          type: array
          description: The SDS job role code for a given prescriber.
          items:
            type: object
            properties:
              coding:
                type: array
                items:
                  type: object
                  properties:
                    system:
                      type: string
                      description: codesystem URL for the job role code
                      enum:
                        - https://fhir.hl7.org.uk/CodeSystem/UKCore-SDSJobRoleName
                    code:
                      type: string
                      description: the SDS job role code
                      example: R8000
                    display:
                      type: string
                      description: human-readable name of the job role for a given job role code
                      example: Clinical Practitioner Access 
        healthcareService:
          type: array
          description: |
            A reference to a healthcareService resource. 
      
            Where a secondary care prescription is being created, this will be a reference to the prescribing organisation.
          items:
            type: object 
            properties:
              reference:
                type: string
                description: a reference to a healthcareService resource within the Bundle.
                example: "urn:uuid:54b0506d-49af-4245-9d40-d7d64902055e"
              display:
                type: string
                description: the name of the prescribing organisation.
                example: "SEVERN FIELDS MEDICAL PRACTICE"
        telecom:
          type: array
          description: the telephone number of a given prescriber.
          items:
            type: object
            properties:
              system:
                description: Means of communication, such as phone or email.
                type: string
                enum: [phone, fax, email, other]
                default: phone
              use:
                type: string
                description: Location associated with the contact details provided.
                enum: [home, work, temp, mobile]
                default: work
              value:
                description: Phone number, email address, or other identifier for use with contact system.
                type: string
                example: '01234567890'
    Cancel-Request-Practitioner:
      type: object
      description: Details of the author or responsible party of a cancel request.
      properties:
        resourceType:
          type: string
          description: FHIR resource type.
          default: "Practitioner"
        identifier:
          type: array
          description: An array containing the prescriber's professional codes and identifiers.
          items:
            type: object
            properties:
              SDS User Identifier:
                type: object
                description: The prescriber's SDS User Identifier
                properties:
                  system:
                    type: string
                    description: codesystem URL for the SDS User Identifier
                    enum:
                      - https://fhir.nhs.uk/Id/sds-user-id
                  value:
                    type: string
                    description: SDS User Identifier
                    example: "555086689107"
        name:
          type: array
          description: The prescriber's name.
          items:
            type: object
            properties:
              family:
                type: string
                description: Family name (often called Surname).
                example: Smith
              given:
                type: array
                description: Given names, including any middle names.
                items:
                  type: string
                  example: Jane
              prefix:
                type: array
                description: Name prefixes, titles, and prenominals.
                items:
                  type: string
                  example: Mrs
    
    Cancel-Response-MessageHeader:
      type: object
      properties:
        resourceType:
          type: string
          description: FHIR resource type.
          default: "MessageHeader"
        eventCoding:
          type: object
          description: The type of message event being generated.
          properties:
            system:
              type: string
              description: codesystem URL for message events.
              enum:
                - "https://fhir.nhs.uk/CodeSystem/message-event"
            code:
              type: string
              description: code for the message event.
              enum:
                - "prescription-order-response"
            display:
              type: string
              description: display value accompanying the code for the message event.
              enum:
                - "Prescription Order Response"
        source:
          type: object
          description: The organisation originating the message. 
          properties:
            endpoint:
              type: string
              description: ODS code of the organisation originating the message, expressed as a URN. 
              example: "urn:nhs-uk:addressing:ods:A83008"
    Cancel-Response-MedicationRequest:
      type: object
      description: A cancel response and any information associated with it will be contained within a MedicationRequest resource. 
      properties:
        resourceType:
          type: string
          description: FHIR resource type
          default: "MedicationRequest"
        extension:
          type: array
          description: a FHIR extension array.
          items:
            anyOf:
            - $ref: "#/components/schemas/extension-cancelResponseReasons.yaml"
            - $ref: "#/components/schemas/extension-medicationRepeatInformation.yaml"
            - $ref: "#/components/schemas/extension-NHSBSAPrescriptionType.yaml"
            - $ref: "#/components/schemas/extension-prescriptionEndorsement.yaml"
            - $ref: "#/components/schemas/extension-DM-ResponsiblePractitioner.yaml"
            - $ref: "#/components/schemas/extension-controlledDrug.yaml"
        identifier: 
          type: array
          description: The unique ID for each line item on a prescription.
          items:
            type: object
            properties:
              system:
                type: string
                description: codesystem URL for the line item ID.
                enum:
                  - https://fhir.nhs.uk/Id/prescription-order-item-number
              value:
                type: string
                description: the unique ID for a given line item.
                example: dd11b07e-e137-488e-bc28-ab50384208b5
        status:
          type: string
          description: |
            The status of a MedicationRequest object. 
            
            This must be consistent across all MedicationRequests in a Bundle.
          enum:
            - active
            - cancelled
            - completed
        intent:
          type: string
          description: |
            The intent of a MedicationRequest object. 
            
            This must be consistent across all MedicationRequests in a Bundle.
          default: order
        medicationCodeableConcept:
          type: object
          description: |
            The medication that is being cancelled. 
            
            This must be defined using VMP or AMP concepts from the dm+d.
          properties:
            coding:
              type: array
              items:
                type: object
                properties:
                  system:
                    type: string
                    description: SNOMED codesystem URL
                    enum:
                      - http://snomed.info/sct
                  code:
                    type: string
                    description: SNOMED code for the medication, as defined in the DM+D
                    example: "321196004"
                  display:
                    type: string
                    description: a human readable name for the medication.
                    example: Diazepam 2mg tablets
        subject:
          type: object
          description: |
            Reference object to identify the patient a prescription is for. 
            
            A Patient resource within the Bundle must be referenced.
          properties: 
            reference:
              type: string
              description: A reference to a Patient resource within the Bundle
              example: urn:uuid:78d3c2eb-009e-4ec8-a358-b042954aa9b2
        requester:
          type: object
          description: |
            Reference object to identify the author of a prescription. 
            
            A PractitionerRole resource within the Bundle must be referenced.
          properties: 
            reference:
              type: string
              description: A reference to a PractitionerRole resource within the Bundle
              example: urn:uuid:56166769-c1c4-4d07-afa8-132b5dfca666
        groupIdentifier:
          type: object
          description: An object containing the short-form and long-form Prescription ID.
          properties:
            system:
              type: string
              description: codesystem URL for the short-form Prescription ID
              enum:
                - "https://fhir.nhs.uk/Id/prescription-order-number"
            value:
              type: string
              description: The short-form Prescription ID
              example: "04F4C2-A99968-7F717P"
            extension:
              type: array
              description: A FHIR extension array containing the long-form Prescription ID.
              items:
                type: object
                properties:
                  url:
                    type: string
                    enum: 
                      - "https://fhir.nhs.uk/StructureDefinition/Extension-DM-PrescriptionId"
                  valueIdentifier:
                    type: object
                    properties:
                      system:
                        type: string
                        description: codesystem URL for the long-form Prescription ID
                        enum:
                          - "https://fhir.nhs.uk/Id/prescription"
                      value:
                        type: string
                        description: The long-form prescription ID
                        example: 613452a2-ca1b-4a76-8191-d92e1f48928c
        dispenseRequest:
          type: object
          description: |
            A FHIR object containing information relevant to how the prescription should be dispensed. 
            
            These values should be consistent across all MedicationRequests in a Bundle.
          properties: 
            performer:
              type: object
              description: |
                Where a cancel response is unsuccessful due to the prescription being with a dispenser, details of the dispenser who downloaded the prescription will be provided as part of the cancel response to enable the prescriber to contact the dispenser.
              properties:
                extension:
                  type: array
                  description: Details of the dispenser who downloaded the prescription
                  items:
                    type: object
                    properties:
                      url: 
                        type: string
                        description: codesystem URL for the dispenser.
                        enum:
                          - "https://fhir.nhs.uk/StructureDefinition/Extension-DM-DispensingPerformer"
                      valueReference:
                        type: object
                        description: A reference to a PractitionerRole resource for the dispenser. 
                        example: "urn:uuid:3c8dbf32-76c1-47e0-b71f-061a3de70b53"
                identifier:
                  type: object
                  properties:
                    system:
                      type: string
                      description: codesystem URL for ODS codes
                      enum:
                        - "https://fhir.nhs.uk/Id/ods-organization-code"
                    value:
                      type: string
                      description: ODS code for the dispensing organisation that downloaded the prescription
                      example: "FCG71"
                display:
                  type: string
                  description: The name of the dispensing organisation that downloaded the prescription
    Cancel-Response-Practitioner:
      type: object
      description: |
        Details of the author or responsible party of a cancel request.
      
        Where a cancel response contains details of the dispenser, details of the dispenser will also be contained within a Practitioner resource.
      properties:
        resourceType:
          type: string
          description: FHIR resource type.
          default: "Practitioner"
        identifier:
          type: array
          description: An array containing the prescriber's professional codes and identifiers.
          items:
            type: object
            properties:
              SDS User Identifier:
                type: object
                description: The prescriber's or dispenser's SDS User Identifier
                properties:
                  system:
                    type: string
                    description: codesystem URL for the SDS User Identifier
                    enum:
                      - https://fhir.nhs.uk/Id/sds-user-id
                      - https://fhir.hl7.org.uk/Id/professional-code
                  value:
                    type: string
                    description: SDS User Identifier
                    example: "555086689107"
        name:
          type: array
          description: The prescriber's or dispenser's name.
          items:
            type: object
            properties:
              family:
                type: string
                description: Family name (often called Surname).
                items:
                  type: string
                  example: Smith
              given:
                type: array
                description: Given names, including any middle names.
                items:
                  type: string
                  example: Clark
              prefix:
                type: array
                description: Name prefixes, titles, and prenominals.
                items:
                  type: string
                  example: Mrs
    Cancel-Response-PractitionerRole:
      type: object
      description: |
        Role-specific details of the author or responsible party of a cancel request. 
      
        Where a cancel response contains details of the dispenser, role-specific details of the dispenser will also be contained within a PractitionerRole resource.
      properties:
        resourceType:
          type: string
          description: FHIR resource type.
          default: "PractitionerRole"
        identifier:
          type: array
          description: An array containing role-specific identifiers for the prescriber or dispenser.
          items:
            type: object
            properties:
              SDS Role Profile ID:
                type: object
                description: The prescriber's SDS Role Profile ID
                properties:
                  system:
                    type: string
                    description: codesystem URL for the SDS role profile ID
                    enum:
                      - https://fhir.nhs.uk/Id/sds-role-profile-id
                  value:
                    type: string
                    description: SDS role profile ID
                    example: "200102238988"
        practitioner:
          type: object
          description: a reference to a Practitioner resource for a given prescriber or dispenser.
          properties:
            reference:
              type: string
              description: a FHIR reference object
              example: urn:uuid:a8c85454-f8cb-498d-9629-78e2cb5fa38b
        organization:
          type: object
          description: | 
            A reference to an Organization resource.
      
            Where the prescription is a primary care prescription, this will be a reference to the prescribing organisation.
            
            Where the prescription is a secondary care prescription, this will be a reference to the managing organisation.
      
            Where the cancel response contains details of the dispenser, this will contain the details of the dispensing organisation.
          properties:
            reference:
              type: string
              description: a FHIR reference object
              example: urn:uuid:a8c85454-f8cb-498d-9629-78e2cb5fa38b
        code:
          type: array
          description: The SDS job role code for a given prescriber or dispenser.
          items:
            type: object
            properties:
              coding:
                type: array
                items:
                  type: object
                  properties:
                    system:
                      type: string
                      description: codesystem URL for the job role code
                      enum:
                        - https://fhir.hl7.org.uk/CodeSystem/UKCore-SDSJobRoleName
                    code:
                      type: string
                      description: the SDS job role code
                      example: R8000
                    display:
                      type: string
                      description: human-readable name of the job role for a given job role code
                      example: Clinical Practitioner Access 
        healthcareService:
          type: array
          description: |
            A reference to a healthcareService resource. 
      
            Where a secondary care prescription is being created, this will be a reference to the prescribing organisation.
          items:
            type: object 
            properties:
              reference:
                type: string
                description: a reference to a healthcareService resource within the Bundle.
                example: "urn:uuid:54b0506d-49af-4245-9d40-d7d64902055e"
              display:
                type: string
                description: the name of the prescribing organisation.
                example: "SEVERN FIELDS MEDICAL PRACTICE"
        telecom:
          type: array
          description: the telephone number of a given prescriber or dispenser.
          items:
            type: object
            properties:
              system:
                description: Means of communication, such as phone or email.
                type: string
                enum: [phone, fax, email, other]
                default: phone
              use:
                type: string
                description: Location associated with the contact details provided.
                enum: [home, work, temp, mobile]
                default: work
              value:
                description: Phone number, email address, or other identifier for use with contact system.
                type: string
                example: '01234567890'
    Cancel-Response-HealthcareService:
      type: object
      description: |
        For secondary care prescriptions only.
        
        Where the prescription is a secondary care prescription, the healthcareService resource will contain details of the prescribing organisation. Details of the prescribing organisation are planned to be deprecated within cancel responses.
      properties:
        resourceType:
          type: string
          description: FHIR resource type.
          default: "healthcareService"
        identifier:
          type: array
          description: An array containing the ODS code of the organisation
          items:  
            type: object
            properties:
              object:
                type: object
                properties:
                  system:
                    type: string
                    description: codesystem URL for the ODS code
                    enum:
                      - https://fhir.nhs.uk/Id/ods-organization-code
                  value:
                    type: string
                    description: ODS code
                    example: "A83008"
        providedBy:
          type: object
          description: The managing organisation that the prescribing organisation is a part of.
          properties:
            identifier:
              type: object
              properties:
                system:
                  type: string
                  description: codesystem URL 
                  enum:
                    - "https://fhir.nhs.uk/Id/ods-organization-code"
                value:
                  type: string
                  description: ODS code for the managing organisation
                  example: "RRE"
        location:
          type: array
          description: |
            A reference to a Location resource.
      
            Where the prescription is a secondary care prescription, the location resource will contain the address of the prescribing organisation.
          items:
            type: object
            properties:
              object: 
                type: object
                properties:
                  reference:
                    type: string
                    description: a reference to a Location resource
        name:
          type: string
          description: Organisation name.
        telecom:
          type: array
          description: The telephone number associated with the organisation.
          items:
            type: object
            properties:
              system:
                description: Means of communication, such as phone or email.
                type: string
                enum: [phone, fax, email, other]
                default: phone
              use:
                type: string
                description: Location associated with the contact details provided.
                enum: [home, work, temp, mobile]
                default: work
              value:
                description: Phone number, email address, or other identifier for use with contact system.
                type: string
                example: '01234567890'
    Cancel-Response-Organization:
      type: object
      description: |
        Details of prescribing organisation (primary care) or the managing organisation (secondary care) for a prescription. Details of the prescribing organisation are planned to be deprecated within cancel responses.
      
        Where a cancel response contains details of the dispenser, the details of the dispensing organisation will also be contained within an Organisation resource.
      properties:
        resourceType:
          type: string
          description: FHIR resource type.
          default: "Organization"
        identifier:
          type: array
          description: An array containing the ODS code of the organisation
          items:
            type: object
            properties:
              system:
                type: string
                description: codesystem URL for the ODS code
                enum:
                  - https://fhir.nhs.uk/Id/ods-organization-code
              value:
                type: string
                description: ODS code
                example: "A83008"
        name:
          type: string
          description: Organisation name.
        address:
          type: array
          description: Organisation address.
          items:
            type: object
            properties:
              use:
                type: string
                description: The purpose of the address. 
                default: work
                enum:
                  - home
                  - work
                  - billing
                  - temp
              type:
                type: string
                description: The type of address.
                default: both
                enum:
                  - postal
                  - physical
                  - both
              line:
                type: array
                description: |
                  All lines of the address except the city, district, and postal code.
      
                  Systems must apply the following formatting convention when adding or replacing addresses lines:
                  *  line 1 - premises ID and/or house name, e.g. `Flat 1` or `The Old Schoolhouse`
                  *  line 2 - house number, dependent thoroughfare name and descriptor (if present), thoroughfare name and descriptor, e.g. `23 Mill Lane`
                  *  line 3 - dependent locality/village, locality (if present), e.g. `Boxgrove`
      
                  If any of the lines are blank, they are not returned due to FHIR conformance constraints.
                items:
                  type: string
                example:
                  - 1 Trevelyan Square
                  - Boar Lane
                  - City Centre
              city:
                type: string
                description: The city of the address. 
                example: Leeds
              district:
                type: string
                description: The district of the address. 
                example: West Yorkshire
              postalCode:
                type: string
                description: The postal code of the address.
                example: LS1 6AE
        telecom:
          type: array
          description: The telephone number associated with the organisation.
          items:
            type: object
            properties:
              system:
                description: Means of communication, such as phone or email.
                type: string
                enum: [phone, fax, email, other]
                default: phone
              use:
                type: string
                description: Location associated with the contact details provided.
                enum: [home, work, temp, mobile]
                default: work
              value:
                description: Phone number, email address, or other identifier for use with contact system.
                type: string
                example: '01234567890'
        partOf:
          type: object
          description: For a primary care prescription, the managing organisation that the prescribing organisation is a part of.
          properties:
            identifier:
              type: object
              description: the ODS code for the managing organisation.
              properties:
                system:
                  type: string
                  description: codesystem URL for the ODS code
                  enum:
                    - "https://fhir.nhs.uk/Id/ods-organization-code"
                value:
                  type: string
                  description: ODS code
                  example: "84H"
            display:
              type: string
              description: the name of the managing organisation
              example: "NHS County Durham CCG"
